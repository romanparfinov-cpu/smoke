<!DOCTYPE html>
<html>
<head>
<title>ISTERIKA</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<style>
/* –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò */
body {
    margin: 0;
    min-height: 100vh;
    background: linear-gradient(135deg, #0f0c29, #302b63 30%, #9d4edd 70%, #3c096c);
    color: #fff;
    font-family: 'Segoe UI', Arial, sans-serif;
    text-align: center;
    position: relative;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    padding-top: 60px;
}

/* –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –ù–ê –°–ê–ô–¢–ï */
.notification {
    position: fixed;
    top: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(20, 15, 45, 0.95);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(157, 78, 221, 0.4);
    border-radius: 12px;
    padding: 15px 25px;
    z-index: 2000;
    display: none;
    align-items: center;
    gap: 15px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from { top: -100px; opacity: 0; }
    to { top: 80px; opacity: 1; }
}

.notification.success {
    border-color: #38ef7d;
    background: rgba(56, 239, 125, 0.1);
}

.notification.error {
    border-color: #ff4d4d;
    background: rgba(255, 77, 77, 0.1);
}

.notification.warning {
    border-color: #ffcc00;
    background: rgba(255, 204, 0, 0.1);
}

.notification-info {
    font-size: 0.9rem;
    color: #d0c0ff;
}

.close-notification {
    background: none;
    border: none;
    color: #fff;
    font-size: 1.2rem;
    cursor: pointer;
    padding: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background 0.3s;
}

.close-notification:hover {
    background: rgba(255, 255, 255, 0.1);
}

.header {
    padding-top: 2vh;
    padding-bottom: 2vh;
    position: relative;
    overflow: hidden;
    z-index: 10;
}

.header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, #9d4edd, transparent);
}

.magazine {
    font-size: 0.8rem;
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-bottom: 2px;
    color: #d0c0ff;
    font-weight: 300;
}

.title {
    font-size: clamp(2rem, 8vw, 3.5rem);
    font-weight: 900;
    letter-spacing: 6px;
    margin: 0;
    background: linear-gradient(45deg, #fff, #9d4edd);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 4px 20px rgba(157, 78, 221, 0.3);
}

.divider {
    width: min(250px, 70vw);
    height: 2px;
    background: linear-gradient(90deg, transparent, #9d4edd 20%, #ff4d8d 50%, #9d4edd 80%, transparent);
    margin: 12px auto;
    border-radius: 2px;
}

/* –ö–ù–û–ü–ö–ê –§–ò–õ–¨–¢–†–ê–¶–ò–ò */
.filter-container {
    display: flex;
    justify-content: center;
    gap: 8px;
    padding: 0 12px 15px;
    flex-wrap: wrap;
    max-width: 1400px;
    margin: 0 auto;
    position: relative;
    z-index: 10;
}

.filter-btn {
    padding: 8px 16px;
    border: 1.5px solid rgba(157, 78, 221, 0.4);
    border-radius: 20px;
    background: rgba(20, 15, 45, 0.8);
    color: #d0c0ff;
    font-weight: 600;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(10px);
    letter-spacing: 0.5px;
    min-width: 90px;
}

.filter-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 10px rgba(157, 78, 221, 0.3);
}

.filter-btn.active {
    background: linear-gradient(45deg, #9d4edd, #6a00ff);
    color: white;
    border-color: #9d4edd;
    box-shadow: 0 3px 15px rgba(157, 78, 221, 0.4);
}

/* –ö–û–ù–¢–ï–ô–ù–ï–† –¢–û–í–ê–†–û–í */
.products {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
    padding: 15px 12px 80px;
    max-width: 1400px;
    margin: 0 auto;
    box-sizing: border-box;
}

/* –ö–û–ú–ü–ê–ö–¢–ù–ê–Ø –ö–ê–†–¢–û–ß–ö–ê –¢–û–í–ê–†–ê */
.product-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 16px;
    border: 1px solid rgba(157, 78, 221, 0.3);
    padding: 0;
    display: flex;
    flex-direction: column;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(8px);
    min-height: 320px; /* –ë–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.product-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(157, 78, 221, 0.5), transparent);
}

.product-item:hover {
    transform: translateY(-5px);
    border-color: #9d4edd;
    box-shadow: 0 12px 30px rgba(157, 78, 221, 0.25);
    background: rgba(255, 255, 255, 0.08);
}

.product-item.delete-mode {
    border: 2px solid #ffcc00;
    box-shadow: 0 0 20px rgba(255, 204, 0, 0.6);
    animation: pulse 2s infinite;
    cursor: pointer;
}

.product-item.edit-mode {
    border: 2px solid #00b4db;
    box-shadow: 0 0 20px rgba(0, 180, 219, 0.6);
    cursor: pointer;
}

/* –§–û–¢–û–ì–†–ê–§–ò–Ø –¢–û–í–ê–†–ê */
.product-photo {
    width: 100%;
    height: 160px; /* –£–º–µ–Ω—å—à–µ–Ω–∞ –≤—ã—Å–æ—Ç–∞ */
    background: linear-gradient(135deg, rgba(157, 78, 221, 0.1), rgba(106, 0, 255, 0.1));
    border-bottom: 1px solid rgba(157, 78, 221, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative;
}

.product-photo img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
}

.product-item:hover .product-photo img {
    transform: scale(1.05);
}

.photo-placeholder {
    color: rgba(255, 255, 255, 0.3);
    font-size: 2.5rem; /* –£–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä */
    font-weight: 300;
}

/* –ö–û–ù–¢–ï–ù–¢ –ö–ê–†–¢–û–ß–ö–ò - –ö–û–ú–ü–ê–ö–¢–ù–´–ô */
.product-content {
    padding: 12px; /* –£–º–µ–Ω—å—à–µ–Ω padding */
    display: flex;
    flex-direction: column;
    flex: 1;
    gap: 4px; /* –£–º–µ–Ω—å—à–µ–Ω gap –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ (–±—ã–ª–æ 6px) */
}

/* –ö–ê–¢–ï–ì–û–†–ò–Ø –£–ë–†–ê–ù–ê –ò–ó –ö–ê–†–¢–û–ß–ö–ò */

.product-name {
    font-size: 1.1rem; /* –ù–µ–º–Ω–æ–≥–æ —É–º–µ–Ω—å—à–µ–Ω */
    font-weight: 800;
    line-height: 1.2;
    min-height: 1.8em; /* –£–º–µ–Ω—å—à–µ–Ω–∞ –≤—ã—Å–æ—Ç–∞ */
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    margin: 0; /* –£–±—Ä–∞–Ω—ã –æ—Ç—Å—Ç—É–ø—ã */
    padding: 0 5px;
}

/* –î–ï–ö–û–†–ê–¢–ò–í–ù–´–ô –†–ê–ó–î–ï–õ–ò–¢–ï–õ–¨ */
.content-divider {
    width: 100%;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(157, 78, 221, 0.4), transparent);
    margin: 2px 0 3px 0; /* –£–º–µ–Ω—å—à–µ–Ω—ã –æ—Ç—Å—Ç—É–ø—ã (–±—ã–ª–æ 4px 0 6px) */
    border-radius: 1px;
}

/* –í–ö–£–°/–û–ü–ò–°–ê–ù–ò–ï –ë–ï–ó –†–ê–ú–ö–ò */
.product-flavor {
    color: #d0c0ff;
    font-size: 1rem; /* –ù–µ–º–Ω–æ–≥–æ —É–º–µ–Ω—å—à–µ–Ω */
    font-weight: 500;
    line-height: 1.3;
    margin: 0; /* –£–±—Ä–∞–Ω—ã –æ—Ç—Å—Ç—É–ø—ã */
    padding: 0;
    flex: 1;
    /* –£–±—Ä–∞–Ω—ã –≤—Å–µ —Ä–∞–º–∫–∏ –∏ —Ñ–æ–Ω—ã */
    background: none;
    border: none;
    box-shadow: none;
    min-height: 1.5em;
}

/* –¶–ï–ù–ê */
.product-price {
    font-size: 1.3rem; /* –ù–µ–º–Ω–æ–≥–æ —É–º–µ–Ω—å—à–µ–Ω */
    font-weight: 800;
    color: #9dff9d;
    margin: 4px 0; /* –£–º–µ–Ω—å—à–µ–Ω—ã –æ—Ç—Å—Ç—É–ø—ã */
}

.discount-price {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px; /* –£–º–µ–Ω—å—à–µ–Ω gap */
    flex-wrap: wrap;
}

.original-price {
    text-decoration: line-through;
    color: #ff9999;
    font-size: 0.9rem; /* –£–º–µ–Ω—å—à–µ–Ω */
    opacity: 0.7;
}

.discount-badge {
    background: linear-gradient(45deg, #ff3366, #ff4d8d);
    color: white;
    padding: 2px 6px; /* –£–º–µ–Ω—å—à–µ–Ω padding */
    border-radius: 6px;
    font-size: 0.75rem; /* –£–º–µ–Ω—å—à–µ–Ω */
    font-weight: 700;
}

.price-number::after {
    content: " BYN";
    font-size: 0.75em; /* –£–º–µ–Ω—å—à–µ–Ω */
    opacity: 0.9;
    margin-left: 2px;
    font-weight: 600;
}

/* –û–°–¢–ê–¢–û–ö - –ë–ï–õ–´–ô, –ñ–ò–†–ù–´–ô, –ë–ï–ó –†–ê–ú–ö–ò */
.quantity-badge {
    padding: 0;
    font-size: 0.85rem;
    font-weight: 700; /* –ñ–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç */
    display: inline-block;
    margin: 2px auto; /* –£–º–µ–Ω—å—à–µ–Ω—ã –æ—Ç—Å—Ç—É–ø—ã */
    width: fit-content;
    color: #fff; /* –ë–µ–ª—ã–π —Ü–≤–µ—Ç */
    /* –£–±—Ä–∞–Ω—ã —Ä–∞–º–∫–∏ –∏ —Ñ–æ–Ω */
    background: none;
    border: none;
}

.quantity-badge.out-of-stock {
    color: #ff4d4d;
}

/* –ö–ù–û–ü–ö–ò */
.buy-btn {
    padding: 10px 15px; /* –£–º–µ–Ω—å—à–µ–Ω padding */
    background: linear-gradient(45deg, #9d4edd, #6a00ff);
    border: none;
    border-radius: 10px;
    color: white;
    font-weight: 700;
    cursor: pointer;
    width: 100%;
    box-sizing: border-box;
    margin-top: 8px; /* –£–º–µ–Ω—å—à–µ–Ω –æ—Ç—Å—Ç—É–ø */
    font-size: 0.9rem; /* –£–º–µ–Ω—å—à–µ–Ω */
    letter-spacing: 0.8px;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
}

.buy-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: 0.5s;
}

.buy-btn:hover::before {
    left: 100%;
}

.buy-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(157, 78, 221, 0.4);
}

.buy-btn:active {
    transform: translateY(0);
}

.buy-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: linear-gradient(45deg, #666, #444);
}

/* –ö–ù–û–ü–ö–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø */
.login-btn-main, .admin-btn-main {
    padding: 10px 20px;
    background: linear-gradient(45deg, rgba(157, 78, 221, 0.9), rgba(106, 0, 255, 0.9));
    border: none;
    border-radius: 10px;
    color: white;
    font-weight: 700;
    cursor: pointer;
    font-size: 0.9rem;
    letter-spacing: 0.8px;
    transition: all 0.3s;
    position: fixed;
    z-index: 1000;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

.login-btn-main {
    top: 15px;
    left: 15px;
    min-width: 90px;
}

.admin-btn-main {
    top: 15px;
    right: 15px;
    min-width: 90px;
    display: none;
    position: fixed;
}

.login-btn-main:hover, .admin-btn-main:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(157, 78, 221, 0.4);
}

/* –§–û–†–ú–ê –õ–û–ì–ò–ù–ê */
.login-form {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20, 15, 45, 0.95);
    border-radius: 20px;
    padding: 30px 25px;
    z-index: 2000;
    width: min(350px, 90vw);
    display: none;
    backdrop-filter: blur(25px);
    border: 1px solid rgba(157, 78, 221, 0.3);
    box-shadow: 
        0 20px 40px -10px rgba(0, 0, 0, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    overflow: hidden;
}

.login-form::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, #9d4edd, transparent);
}

.login-form h3 {
    color: #fff;
    font-size: 1.6rem;
    margin: 0 0 25px 0;
    text-align: center;
    font-weight: 700;
    background: linear-gradient(45deg, #fff, #9d4edd);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.login-input-container {
    position: relative;
    margin-bottom: 20px;
}

.login-input-container input {
    width: 100%;
    padding: 14px 18px;
    background: rgba(255, 255, 255, 0.08);
    border: 2px solid rgba(157, 78, 221, 0.3);
    border-radius: 10px;
    color: #fff;
    font-size: 0.95rem;
    transition: all 0.3s;
    box-sizing: border-box;
}

.login-input-container input:focus {
    outline: none;
    border-color: #9d4edd;
    background: rgba(255, 255, 255, 0.12);
    box-shadow: 0 0 15px rgba(157, 78, 221, 0.3);
}

.login-input-container input::placeholder {
    color: rgba(255, 255, 255, 0.5);
}

.login-buttons {
    display: flex;
    gap: 12px;
    margin-top: 10px;
}

.login-btn, .cancel-login-btn {
    flex: 1;
    padding: 13px;
    border: none;
    border-radius: 10px;
    font-weight: 700;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s;
    letter-spacing: 0.8px;
}

.login-btn {
    background: linear-gradient(45deg, #9d4edd, #6a00ff);
    color: white;
}

.login-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(157, 78, 221, 0.4);
}

.cancel-login-btn {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    border: 2px solid rgba(157, 78, 221, 0.5);
}

.cancel-login-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

/* –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ - –£–ú–ï–ù–¨–®–ï–ù–ù–ê–Ø –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–´–• */
.admin-panel {
    position: fixed;
    top: 60px;
    right: 15px;
    background: rgba(20, 15, 45, 0.95);
    border-radius: 14px;
    padding: 15px; /* –£–º–µ–Ω—å—à–µ–Ω padding (–±—ã–ª–æ 20px) */
    z-index: 1000;
    display: none;
    backdrop-filter: blur(25px);
    border: 1px solid rgba(157, 78, 221, 0.3);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
    min-width: 250px;
    max-height: 80vh; /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã */
    overflow-y: auto; /* –°–∫—Ä–æ–ª–ª –µ—Å–ª–∏ –Ω–µ –≤–ª–µ–∑–∞–µ—Ç */
}

.admin-panel h3 {
    color: #fff;
    margin: 0 0 12px 0; /* –£–º–µ–Ω—å—à–µ–Ω –æ—Ç—Å—Ç—É–ø (–±—ã–ª–æ 15px) */
    font-size: 1.2rem; /* –£–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä (–±—ã–ª–æ 1.3rem) */
    text-align: center;
    font-weight: 700;
}

.admin-btn, .logout-btn {
    width: 100%;
    padding: 10px; /* –£–º–µ–Ω—å—à–µ–Ω padding (–±—ã–ª–æ 12px) */
    margin: 4px 0; /* –£–º–µ–Ω—å—à–µ–Ω –æ—Ç—Å—Ç—É–ø (–±—ã–ª–æ 6px 0) */
    border: none;
    border-radius: 10px;
    font-weight: 700;
    font-size: 0.85rem; /* –£–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä (–±—ã–ª–æ 0.9rem) */
    cursor: pointer;
    transition: all 0.3s;
}

.admin-btn {
    background: linear-gradient(45deg, #9d4edd, #6a00ff);
    color: white;
}

.admin-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(157, 78, 221, 0.4);
}

.admin-btn.edit-btn {
    background: linear-gradient(45deg, #00b4db, #0083b0);
}

.admin-btn.delete-btn {
    background: linear-gradient(45deg, #ff4d4d, #d43f3f);
}

.admin-btn.stats-btn {
    background: linear-gradient(45deg, #8e2de2, #4a00e0);
}

.admin-btn.photo-btn {
    background: linear-gradient(45deg, #ffcc00, #ff9900);
}

.logout-btn {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    border: 2px solid rgba(157, 78, 221, 0.3);
    margin-top: 10px; /* –£–º–µ–Ω—å—à–µ–Ω –æ—Ç—Å—Ç—É–ø (–±—ã–ª–æ 12px) */
    font-size: 0.85rem; /* –£–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä */
}

.logout-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

/* –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê */
.add-modal, .edit-modal, .photo-modal, .photo-zoom-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20, 15, 45, 0.95);
    border-radius: 20px;
    padding: 30px 25px;
    z-index: 2000;
    width: min(400px, 90vw);
    display: none;
    backdrop-filter: blur(25px);
    border: 1px solid rgba(157, 78, 221, 0.3);
    box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.5);
}

.add-modal h3, .edit-modal h3, .photo-modal h3, .photo-zoom-modal h3 {
    color: #fff;
    font-size: 1.6rem;
    margin: 0 0 25px 0;
    text-align: center;
    font-weight: 700;
}

.modal-input-container {
    position: relative;
    margin-bottom: 15px;
}

.modal-input-container input,
.modal-input-container select {
    width: 100%;
    padding: 13px 18px;
    background: rgba(255, 255, 255, 0.08);
    border: 2px solid rgba(157, 78, 221, 0.3);
    border-radius: 10px;
    color: #fff;
    font-size: 0.95rem;
    transition: all 0.3s;
    box-sizing: border-box;
}

.modal-input-container select {
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' fill='%239d4edd' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 18px center;
    background-size: 10px;
}

.modal-input-container input:focus,
.modal-input-container select:focus {
    outline: none;
    border-color: #9d4edd;
    background: rgba(255, 255, 255, 0.12);
    box-shadow: 0 0 15px rgba(157, 78, 221, 0.3);
}

.modal-input-container select option {
    background: #1a1a2e;
    color: #fff;
}

/* –ü–û–õ–ï –ó–ê–ì–†–£–ó–ö–ò –§–û–¢–û –° –ú–ê–°–®–¢–ê–ë–ò–†–û–í–ê–ù–ò–ï–ú */
.photo-upload-container {
    margin-bottom: 20px;
}

.photo-preview-container {
    width: 200px;
    height: 200px;
    margin: 0 auto 15px;
    border: 2px dashed rgba(157, 78, 221, 0.3);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    background: rgba(255, 255, 255, 0.05);
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
}

.photo-preview-container:hover {
    border-color: #9d4edd;
    background: rgba(255, 255, 255, 0.08);
}

.photo-preview {
    width: 100%;
    height: 100%;
    object-fit: contain;
    transform-origin: center center;
    transition: transform 0.3s;
}

.photo-placeholder-icon {
    font-size: 2.5rem;
    color: rgba(157, 78, 221, 0.5);
}

.photo-zoom-controls {
    margin-top: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
}

.zoom-btn {
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(157, 78, 221, 0.3);
    border-radius: 50%;
    color: white;
    font-size: 1.2rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
}

.zoom-btn:hover {
    background: rgba(157, 78, 221, 0.3);
    transform: scale(1.1);
}

.zoom-value {
    min-width: 60px;
    text-align: center;
    color: #d0c0ff;
    font-weight: 600;
}

.photo-upload-btn {
    display: block;
    width: 100%;
    padding: 12px;
    background: linear-gradient(45deg, #9d4edd, #6a00ff);
    border: none;
    border-radius: 10px;
    color: white;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s;
    margin-top: 10px;
}

.photo-upload-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(157, 78, 221, 0.4);
}

.photo-controls {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.photo-control-btn {
    flex: 1;
    padding: 10px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(157, 78, 221, 0.3);
    border-radius: 8px;
    color: white;
    cursor: pointer;
    transition: all 0.3s;
}

.photo-control-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

.photo-error {
    color: #ff4d4d;
    font-size: 0.85rem;
    margin-top: 8px;
    text-align: center;
    display: none;
}

.discount-container {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 10px;
    margin-bottom: 15px;
}

.discount-input {
    padding: 13px 18px;
    background: rgba(255, 255, 255, 0.08);
    border: 2px solid rgba(157, 78, 221, 0.3);
    border-radius: 10px;
    color: #fff;
    font-size: 0.95rem;
    transition: all 0.3s;
    box-sizing: border-box;
}

.discount-input:focus {
    outline: none;
    border-color: #9d4edd;
    background: rgba(255, 255, 255, 0.12);
    box-shadow: 0 0 15px rgba(157, 78, 221, 0.3);
}

.modal-buttons {
    display: flex;
    gap: 12px;
    margin-top: 10px;
}

.confirm-modal-btn, .cancel-modal-btn {
    flex: 1;
    padding: 13px;
    border: none;
    border-radius: 10px;
    font-weight: 700;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s;
}

.confirm-modal-btn {
    background: linear-gradient(45deg, #9d4edd, #6a00ff);
    color: white;
}

.confirm-modal-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(157, 78, 221, 0.4);
}

.cancel-modal-btn {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    border: 2px solid rgba(157, 78, 221, 0.5);
}

.cancel-modal-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

/* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ü–û–ö–£–ü–ö–ò */
.buy-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20, 15, 45, 0.98);
    border-radius: 20px;
    padding: 30px 25px;
    z-index: 2000;
    width: min(380px, 90vw);
    display: none;
    backdrop-filter: blur(30px);
    border: 1px solid rgba(157, 78, 221, 0.4);
    box-shadow: 
        0 25px 50px rgba(0, 0, 0, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.buy-modal h3 {
    color: #fff;
    font-size: 1.5rem;
    margin: 0 0 15px 0;
    text-align: center;
    font-weight: 700;
}

.order-text-block {
    background: linear-gradient(135deg, rgba(157, 78, 221, 0.1), rgba(106, 0, 255, 0.1));
    border: 2px solid rgba(157, 78, 221, 0.3);
    border-radius: 14px;
    padding: 20px;
    margin: 15px 0 20px;
    text-align: left;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
}

.order-text-block::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(157, 78, 221, 0.5), transparent);
}

.order-text-block:hover {
    background: linear-gradient(135deg, rgba(157, 78, 221, 0.15), rgba(106, 0, 255, 0.15));
    border-color: #9d4edd;
    transform: translateY(-2px);
}

.order-text {
    font-family: 'Courier New', monospace;
    color: #d0c0ff;
    font-size: 0.9rem;
    line-height: 1.5;
    white-space: pre-wrap;
    margin: 0;
}

.telegram-info {
    background: linear-gradient(135deg, rgba(0, 136, 204, 0.1), rgba(157, 78, 221, 0.1));
    border: 2px solid rgba(0, 136, 204, 0.3);
    border-radius: 14px;
    padding: 18px;
    margin-bottom: 20px;
    text-align: left;
}

.telegram-info a {
    display: flex;
    align-items: center;
    gap: 12px;
    text-decoration: none;
    color: inherit;
}

.telegram-icon {
    width: 45px;
    height: 45px;
    background: linear-gradient(45deg, #0088cc, #00aced);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    flex-shrink: 0;
}

.telegram-text {
    flex: 1;
}

.telegram-title {
    font-weight: 700;
    font-size: 1rem;
    margin-bottom: 3px;
    color: #fff;
}

.telegram-subtitle {
    color: #66ccff;
    font-size: 0.85rem;
    opacity: 0.9;
}

.close-buy-btn {
    width: 100%;
    padding: 14px;
    background: linear-gradient(45deg, #9d4edd, #6a00ff);
    border: none;
    border-radius: 10px;
    color: white;
    font-weight: 700;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s;
    letter-spacing: 0.8px;
}

.close-buy-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(157, 78, 221, 0.4);
}

/* –û–í–ï–†–õ–ï–ô */
.overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.9);
    z-index: 1500;
    display: none;
    backdrop-filter: blur(5px);
}

/* –ö–ù–û–ü–ö–ò –í–´–•–û–î–ê –ò–ó –†–ï–ñ–ò–ú–û–í */
.exit-delete-btn {
    position: fixed;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 30px;
    background: linear-gradient(45deg, #ff4d4d, #d43f3f);
    border: none;
    border-radius: 50px;
    color: white;
    font-weight: 700;
    cursor: pointer;
    z-index: 1000;
    display: none;
    font-size: 0.95rem;
    letter-spacing: 0.8px;
    box-shadow: 0 4px 15px rgba(255, 77, 77, 0.4);
    transition: all 0.3s;
}

.exit-edit-btn {
    position: fixed;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 30px;
    background: linear-gradient(45deg, #00b4db, #0083b0);
    border: none;
    border-radius: 50px;
    color: white;
    font-weight: 700;
    cursor: pointer;
    z-index: 1000;
    display: none;
    font-size: 0.95rem;
    letter-spacing: 0.8px;
    box-shadow: 0 4px 15px rgba(0, 180, 219, 0.4);
    transition: all 0.3s;
}

.exit-delete-btn:hover, .exit-edit-btn:hover {
    transform: translateX(-50%) translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
}

.copy-info {
    text-align: center;
    margin-top: 8px;
    color: #66ccff;
    font-size: 0.8rem;
    font-style: italic;
    opacity: 0.8;
}

/* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –°–¢–ê–¢–ò–°–¢–ò–ö–ò */
.stats-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20, 15, 45, 0.98);
    border-radius: 20px;
    padding: 25px;
    z-index: 2000;
    width: min(400px, 90vw);
    display: none;
    backdrop-filter: blur(30px);
    border: 1px solid rgba(157, 78, 221, 0.4);
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6);
}

/* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –£–ü–†–ê–í–õ–ï–ù–ò–Ø –†–ï–ó–ï–†–í–ù–´–ú–ò –ö–û–ü–ò–Ø–ú–ò */
.backup-modal, .backup-menu-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20, 15, 45, 0.98);
    border-radius: 20px;
    padding: 25px;
    z-index: 2000;
    width: min(500px, 90vw);
    max-height: 80vh;
    display: none;
    backdrop-filter: blur(30px);
    border: 1px solid rgba(157, 78, 221, 0.4);
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6);
    overflow-y: auto;
}

/* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
@media (max-width: 480px) {
    body {
        padding-top: 50px;
    }
    
    .notification {
        top: 65px;
    }
    
    @keyframes slideDown {
        from { top: -100px; opacity: 0; }
        to { top: 65px; opacity: 1; }
    }
    
    .products {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        padding: 12px 10px 70px;
    }
    
    .product-item {
        min-height: 300px; /* –ï—â–µ –±–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
    }
    
    .product-photo {
        height: 140px;
    }
    
    .product-name {
        font-size: 1rem;
        min-height: 1.6em;
    }
    
    .product-flavor {
        font-size: 0.9rem;
    }
    
    .login-btn-main, .admin-btn-main {
        padding: 8px 16px;
        font-size: 0.85rem;
        top: 10px;
        left: 10px;
        right: 10px;
        min-width: 80px;
    }
    
    .admin-panel {
        top: 50px;
        right: 10px;
        min-width: 220px;
        padding: 12px; /* –ï—â–µ –º–µ–Ω—å—à–µ padding –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        max-height: 70vh; /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã */
    }
    
    .admin-panel h3 {
        font-size: 1.1rem; /* –£–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        margin-bottom: 10px;
    }
    
    .admin-btn, .logout-btn {
        padding: 9px; /* –£–º–µ–Ω—å—à–µ–Ω padding –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        margin: 3px 0; /* –£–º–µ–Ω—å—à–µ–Ω –æ—Ç—Å—Ç—É–ø */
        font-size: 0.82rem; /* –£–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
    }
    
    .filter-container {
        gap: 6px;
        padding: 0 10px 12px;
    }
    
    .filter-btn {
        padding: 7px 14px;
        font-size: 0.8rem;
        min-width: 80px;
    }
    
    .login-form, .add-modal, .edit-modal, .buy-modal, .stats-modal, .backup-modal, .backup-menu-modal {
        padding: 25px 20px;
    }
    
    .photo-preview-container {
        width: 150px;
        height: 150px;
    }
}

@media (min-width: 481px) and (max-width: 768px) {
    .products {
        grid-template-columns: repeat(2, 1fr);
        gap: 14px;
    }
    
    .product-photo {
        height: 160px;
    }
    
    .admin-panel {
        right: 15px;
        max-height: 75vh; /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã */
    }
}

@media (min-width: 769px) {
    .products {
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        padding: 20px 15px 90px;
    }
    
    .product-item {
        min-height: 340px; /* –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ */
    }
    
    .product-photo {
        height: 180px;
    }
    
    .admin-panel {
        right: 20px;
    }
}

@media (min-width: 1200px) {
    .products {
        grid-template-columns: repeat(4, 1fr);
        gap: 24px;
        padding: 25px 20px 100px;
    }
    
    .product-item {
        min-height: 360px;
    }
    
    .product-photo {
        height: 200px;
    }
}

@keyframes pulse {
    0% { box-shadow: 0 0 15px rgba(255, 204, 0, 0.5); }
    50% { box-shadow: 0 0 25px rgba(255, 204, 0, 0.9); }
    100% { box-shadow: 0 0 15px rgba(255, 204, 0, 0.5); }
}
</style>
</head>
<body>

<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–∞–π—Ç–∞ -->
<div class="notification" id="notification">
    <span class="notification-info" id="notificationText"></span>
    <button class="close-notification" onclick="closeNotification()">√ó</button>
</div>

<!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
<button class="login-btn-main" id="loginBtn" onclick="showLoginForm()">–í–æ–π—Ç–∏</button>
<button class="admin-btn-main" id="adminBtn" onclick="toggleAdminPanel()">–ê–¥–º–∏–Ω</button>

<!-- –ö—Ä–∞—Å–∏–≤–∞—è —Ñ–æ—Ä–º–∞ –ª–æ–≥–∏–Ω–∞ -->
<div class="login-form" id="loginForm">
    <h3>–í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∞</h3>
    <div class="login-input-container">
        <input type="password" id="adminPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="off">
    </div>
    <div class="login-buttons">
        <button class="login-btn" onclick="login()">–í–æ–π—Ç–∏</button>
        <button class="cancel-login-btn" onclick="hideLoginForm()">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>

<!-- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å -->
<div class="admin-panel" id="adminPanel">
    <h3>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h3>
    
    <button class="admin-btn" onclick="showAddModal()">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
    <button class="admin-btn edit-btn" onclick="startEditMode()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã</button>
    <button class="admin-btn delete-btn" onclick="startDeleteMode()">–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä—ã</button>
    <button class="admin-btn stats-btn" onclick="showStatsModal()">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
    <button class="admin-btn photo-btn" onclick="showPhotoManager()">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ</button>
    <button class="admin-btn" onclick="showBackupMenu()" style="background: linear-gradient(45deg, #ffcc00, #ff9900);">
        –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
    </button>
    <button class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ —Å —Ñ–æ—Ç–æ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º -->
<div class="add-modal" id="addModal">
    <h3>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
    
    <div class="photo-upload-container">
        <div class="photo-preview-container" id="addPhotoPreviewContainer" onclick="document.getElementById('addProductPhoto').click()">
            <div class="photo-placeholder-icon">üì∑</div>
        </div>
        <input type="file" id="addProductPhoto" accept="image/jpeg,image/png" style="display: none;" onchange="previewAddPhoto(event)">
        <div class="photo-error" id="addPhotoError"></div>
        
        <div class="photo-zoom-controls" id="addZoomControls" style="display: none;">
            <button class="zoom-btn" onclick="zoomOut('add')">-</button>
            <div class="zoom-value" id="addZoomValue">100%</div>
            <button class="zoom-btn" onclick="zoomIn('add')">+</button>
        </div>
        
        <button type="button" class="photo-upload-btn" onclick="document.getElementById('addProductPhoto').click()">
            –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞
        </button>
    </div>
    
    <div class="modal-input-container">
        <input type="text" id="productName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" required>
    </div>
    <div class="modal-input-container">
        <input type="text" id="productFlavor" placeholder="–í–∫—É—Å/–ë—Ä–µ–Ω–¥/–¢–∏–ø" required>
    </div>
    <div class="modal-input-container">
        <select id="productCategory" required onchange="updateFlavorPlaceholder()">
            <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
            <option value="liquid">–ñ–∏–¥–∫–æ—Å—Ç—å</option>
            <option value="pod">–ü–æ–¥-—Å–∏—Å—Ç–µ–º–∞</option>
            <option value="snus">–°–Ω—é—Å</option>
            <option value="other">–†–∞—Å—Ö–æ–¥–Ω–∏–∫</option>
        </select>
    </div>
    <div class="modal-input-container">
        <input type="number" id="productPrice" placeholder="–¶–µ–Ω–∞ (BYN)" min="0" step="0.01" required>
    </div>
    <div class="discount-container">
        <input type="number" class="discount-input" id="productDiscount" placeholder="–°–∫–∏–¥–∫–∞ % (0-99)" min="0" max="99" step="1">
        <select class="discount-input" id="discountType">
            <option value="percent">%</option>
            <option value="fixed">BYN</option>
        </select>
    </div>
    <div class="modal-input-container">
        <input type="number" id="productQuantity" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" min="0" required>
    </div>
    <div class="modal-buttons">
        <button class="confirm-modal-btn" onclick="addProduct()">–î–æ–±–∞–≤–∏—Ç—å</button>
        <button class="cancel-modal-btn" onclick="closeAddModal()">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ —Å —Ñ–æ—Ç–æ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º -->
<div class="edit-modal" id="editModal">
    <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä</h3>
    
    <div class="photo-upload-container">
        <div class="photo-preview-container" id="editPhotoPreviewContainer" onclick="document.getElementById('editProductPhoto').click()">
            <div class="photo-placeholder-icon">üì∑</div>
        </div>
        <input type="file" id="editProductPhoto" accept="image/jpeg,image/png" style="display: none;" onchange="previewEditPhoto(event)">
        <div class="photo-error" id="editPhotoError"></div>
        
        <div class="photo-zoom-controls" id="editZoomControls" style="display: none;">
            <button class="zoom-btn" onclick="zoomOut('edit')">-</button>
            <div class="zoom-value" id="editZoomValue">100%</div>
            <button class="zoom-btn" onclick="zoomIn('edit')">+</button>
        </div>
        
        <button type="button" class="photo-upload-btn" onclick="document.getElementById('editProductPhoto').click()">
            –ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞
        </button>
    </div>
    
    <div class="modal-input-container">
        <input type="text" id="editProductName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" required>
    </div>
    <div class="modal-input-container">
        <input type="text" id="editProductFlavor" placeholder="–í–∫—É—Å/–ë—Ä–µ–Ω–¥/–¢–∏–ø" required>
    </div>
    <div class="modal-input-container">
        <select id="editProductCategory" required onchange="updateEditFlavorPlaceholder()">
            <option value="liquid">–ñ–∏–¥–∫–æ—Å—Ç—å</option>
            <option value="pod">–ü–æ–¥-—Å–∏—Å—Ç–µ–º–∞</option>
            <option value="snus">–°–Ω—é—Å</option>
            <option value="other">–†–∞—Å—Ö–æ–¥–Ω–∏–∫</option>
        </select>
    </div>
    <div class="modal-input-container">
        <input type="number" id="editProductPrice" placeholder="–¶–µ–Ω–∞ (BYN)" min="0" step="0.01" required>
    </div>
    <div class="discount-container">
        <input type="number" class="discount-input" id="editProductDiscount" placeholder="–°–∫–∏–¥–∫–∞ % (0-99)" min="0" max="99" step="1">
        <select class="discount-input" id="editDiscountType">
            <option value="percent">%</option>
            <option value="fixed">BYN</option>
        </select>
    </div>
    <div class="modal-input-container">
        <input type="number" id="editProductQuantity" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" min="0" required>
    </div>
    <div class="modal-buttons">
        <button class="confirm-modal-btn" onclick="saveProductEdit()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="cancel-modal-btn" onclick="closeEditModal()">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏ -->
<div class="photo-modal" id="photoModal">
    <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏</h3>
    
    <div id="photoManagerContent" style="
        max-height: 400px;
        overflow-y: auto;
        margin: 15px 0;
        padding: 10px;
        background: rgba(0,0,0,0.2);
        border-radius: 10px;
        border: 1px solid rgba(157,78,221,0.3);
    ">
        <div style="text-align:center;color:#aaa;padding:20px;">
            –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...
        </div>
    </div>
    
    <div class="modal-buttons">
        <button class="confirm-modal-btn" onclick="closePhotoModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
<div class="stats-modal" id="statsModal">
    <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞</h3>
    
    <div id="statsContent" style="
        background: rgba(20, 15, 45, 0.6);
        border-radius: 10px;
        padding: 20px;
        margin: 15px 0;
        border: 1px solid rgba(157, 78, 221, 0.3);
        text-align: center;
    ">
        <div style="color: #d0c0ff; font-size: 0.9rem; margin-bottom: 15px;">
            –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...
        </div>
    </div>
    
    <div class="modal-buttons">
        <button class="confirm-modal-btn" onclick="closeStatsModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∫—É–ø–∫–∏ -->
<div class="buy-modal" id="buyModal">
    <h3>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h3>
    <div class="order-text-block" id="orderTextBlock">
        <div class="order-text" id="orderText"></div>
    </div>
    <div class="copy-info">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ç–µ–∫—Å—Ç –≤—ã—à–µ, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</div>
    <div class="telegram-info">
        <a href="https://t.me/tat02w" target="_blank">
            <div class="telegram-icon">‚úà</div>
            <div class="telegram-text">
                <div class="telegram-title">–°–≤—è–∂–∏—Ç–µ—Å—å –≤ Telegram</div>
                <div class="telegram-subtitle">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –Ω–∞–ø–∏—Å–∞—Ç—å @tat02w</div>
            </div>
        </a>
    </div>
    <button class="close-buy-btn" onclick="closeBuyModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<!-- –ú–µ–Ω—é —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è (—É–¥–∞–ª–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ –≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç) -->
<div class="backup-menu-modal" id="backupMenuModal">
    <h3>–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
    
    <button class="admin-btn" onclick="showBackupManager()" style="margin-bottom: 10px; background: linear-gradient(45deg, #ffcc00, #ff9900);">
        –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏
    </button>
    
    <div class="modal-buttons">
        <button class="cancel-modal-btn" onclick="closeBackupMenu()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏ -->
<div class="backup-modal" id="backupModal">
    <h3>–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏</h3>
    
    <div id="backupList" style="
        max-height: 300px;
        overflow-y: auto;
        margin: 15px 0;
        padding: 10px;
        background: rgba(0,0,0,0.2);
        border-radius: 10px;
        border: 1px solid rgba(157,78,221,0.3);
    ">
        <div style="text-align:center;color:#aaa;padding:20px;">
            –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π...
        </div>
    </div>
    
    <div class="modal-buttons">
        <button class="confirm-modal-btn" onclick="createManualBackup()" style="background:linear-gradient(45deg, #9d4edd, #6a00ff);">
            –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
        </button>
        <button class="cancel-modal-btn" onclick="closeBackupModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<!-- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ä–µ–∂–∏–º–∞ —É–¥–∞–ª–µ–Ω–∏—è -->
<button class="exit-delete-btn" id="exitDeleteBtn" onclick="exitDeleteMode()">‚úï –û—Ç–º–µ–Ω–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ</button>

<!-- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
<button class="exit-edit-btn" id="exitEditBtn" onclick="exitEditMode()">‚úï –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</button>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è -->
<div class="add-modal delete-modal" id="deleteModal">
    <h3>–£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</h3>
    <p id="deleteProductInfo" style="color: #d0c0ff; text-align: center; margin: 20px 0;">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?</p>
    <div class="modal-buttons">
        <button class="confirm-modal-btn" onclick="confirmDelete()" style="background: linear-gradient(45deg, #ff4d4d, #d43f3f);">–£–¥–∞–ª–∏—Ç—å</button>
        <button class="cancel-modal-btn" onclick="cancelDelete()">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>

<!-- –û–≤–µ—Ä–ª–µ–π -->
<div class="overlay" id="overlay" onclick="closeAllModals()"></div>

<!-- –®–∞–ø–∫–∞ -->
<div class="header">
    <div class="magazine">–ú–∞–≥–∞–∑–∏–Ω</div>
    <div class="title">ISTERIKA</div>
    <div class="divider"></div>
</div>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<div class="filter-container" id="filterContainer">
    <button class="filter-btn active" onclick="filterProducts('all')">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</button>
    <button class="filter-btn" onclick="filterProducts('liquid')">–ñ–∏–¥–∫–æ—Å—Ç–∏</button>
    <button class="filter-btn" onclick="filterProducts('pod')">–ü–æ–¥-—Å–∏—Å—Ç–µ–º—ã</button>
    <button class="filter-btn" onclick="filterProducts('snus')">–°–Ω—é—Å</button>
    <button class="filter-btn" onclick="filterProducts('other')">–†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏</button>
</div>

<!-- –¢–æ–≤–∞—Ä—ã -->
<div class="products" id="productsContainer">
    <div style="grid-column:1/-1; padding: 40px; color: #aaa;" id="loadingText">
        –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...
    </div>
</div>

<script>
// ====================== –ù–ê–°–¢–†–û–ô–ö–ê FIREBASE ======================
const firebaseConfig = {
  apiKey: "AIzaSyAKqapbYPKkvnp63IANSSDj5NBTITz49yk",
  authDomain: "smoke-shop-982fb.firebaseapp.com",
  databaseURL: "https://smoke-shop-982fb-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "smoke-shop-982fb",
  storageBucket: "smoke-shop-982fb.firebasestorage.app",
  messagingSenderId: "1037879903984",
  appId: "1:1037879903984:web:57b4269729cac1cc6a2435",
  measurementId: "G-NRB44ZW03M"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// ====================== –ü–ï–†–ï–ú–ï–ù–ù–´–ï ======================
let deleteMode = false;
let editMode = false;
let productToDelete = null;
let currentProductId = null;
let orderText = '';
let currentFilter = 'all';
let productsRef = null;
let isOperationInProgress = false;

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–æ—Ç–æ
let currentPhotoFile = null;
let currentEditPhotoFile = null;
let addZoomLevel = 1;
let editZoomLevel = 1;

// ====================== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ======================
function showNotification(message, type = 'info', duration = 3000) {
    const notification = document.getElementById('notification');
    const notificationText = document.getElementById('notificationText');
    
    notificationText.textContent = message;
    notification.className = 'notification ' + type;
    notification.style.display = 'flex';
    
    if (duration > 0) {
        setTimeout(() => {
            notification.style.display = 'none';
        }, duration);
    }
}

function closeNotification() {
    document.getElementById('notification').style.display = 'none';
}

// ====================== –°–ò–°–¢–ï–ú–ê –§–û–¢–û–ì–†–ê–§–ò–ô –° –ú–ê–°–®–¢–ê–ë–ò–†–û–í–ê–ù–ò–ï–ú ======================
function previewAddPhoto(event) {
    const file = event.target.files[0];
    const errorDiv = document.getElementById('addPhotoError');
    const previewContainer = document.getElementById('addPhotoPreviewContainer');
    const zoomControls = document.getElementById('addZoomControls');
    
    if (!file) return;
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    const validTypes = ['image/jpeg', 'image/png'];
    const maxSize = 5 * 1024 * 1024; // 5MB
    
    if (!validTypes.includes(file.type)) {
        errorDiv.textContent = '–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å JPG –∏–ª–∏ PNG';
        errorDiv.style.display = 'block';
        return;
    }
    
    if (file.size > maxSize) {
        errorDiv.textContent = '–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5MB';
        errorDiv.style.display = 'block';
        return;
    }
    
    errorDiv.style.display = 'none';
    currentPhotoFile = file;
    addZoomLevel = 1; // –°–±—Ä–æ—Å –º–∞—Å—à—Ç–∞–±–∞
    
    const reader = new FileReader();
    reader.onload = function(e) {
        const img = document.createElement('img');
        img.src = e.target.result;
        img.className = 'photo-preview';
        img.id = 'addPhotoPreview';
        img.style.transform = `scale(${addZoomLevel})`;
        
        previewContainer.innerHTML = '';
        previewContainer.appendChild(img);
        
        zoomControls.style.display = 'flex';
        document.getElementById('addZoomValue').textContent = Math.round(addZoomLevel * 100) + '%';
    };
    reader.readAsDataURL(file);
}

function previewEditPhoto(event) {
    const file = event.target.files[0];
    const errorDiv = document.getElementById('editPhotoError');
    const previewContainer = document.getElementById('editPhotoPreviewContainer');
    const zoomControls = document.getElementById('editZoomControls');
    
    if (!file) return;
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    const validTypes = ['image/jpeg', 'image/png'];
    const maxSize = 5 * 1024 * 1024; // 5MB
    
    if (!validTypes.includes(file.type)) {
        errorDiv.textContent = '–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å JPG –∏–ª–∏ PNG';
        errorDiv.style.display = 'block';
        return;
    }
    
    if (file.size > maxSize) {
        errorDiv.textContent = '–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5MB';
        errorDiv.style.display = 'block';
        return;
    }
    
    errorDiv.style.display = 'none';
    currentEditPhotoFile = file;
    editZoomLevel = 1; // –°–±—Ä–æ—Å –º–∞—Å—à—Ç–∞–±–∞
    
    const reader = new FileReader();
    reader.onload = function(e) {
        const img = document.createElement('img');
        img.src = e.target.result;
        img.className = 'photo-preview';
        img.id = 'editPhotoPreview';
        img.style.transform = `scale(${editZoomLevel})`;
        
        previewContainer.innerHTML = '';
        previewContainer.appendChild(img);
        
        zoomControls.style.display = 'flex';
        document.getElementById('editZoomValue').textContent = Math.round(editZoomLevel * 100) + '%';
    };
    reader.readAsDataURL(file);
}

// –§—É–Ω–∫—Ü–∏–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è - –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï
function zoomIn(type) {
    if (type === 'add') {
        if (addZoomLevel < 3) {
            addZoomLevel += 0.1;
            const preview = document.getElementById('addPhotoPreview');
            if (preview) {
                preview.style.transform = `scale(${addZoomLevel})`;
                document.getElementById('addZoomValue').textContent = Math.round(addZoomLevel * 100) + '%';
            }
        }
    } else if (type === 'edit') {
        if (editZoomLevel < 3) {
            editZoomLevel += 0.1;
            const preview = document.getElementById('editPhotoPreview');
            if (preview) {
                preview.style.transform = `scale(${editZoomLevel})`;
                document.getElementById('editZoomValue').textContent = Math.round(editZoomLevel * 100) + '%';
            }
        }
    }
}

function zoomOut(type) {
    if (type === 'add') {
        if (addZoomLevel > 0.3) {
            addZoomLevel -= 0.1;
            const preview = document.getElementById('addPhotoPreview');
            if (preview) {
                preview.style.transform = `scale(${addZoomLevel})`;
                document.getElementById('addZoomValue').textContent = Math.round(addZoomLevel * 100) + '%';
            }
        }
    } else if (type === 'edit') {
        if (editZoomLevel > 0.3) {
            editZoomLevel -= 0.1;
            const preview = document.getElementById('editPhotoPreview');
            if (preview) {
                preview.style.transform = `scale(${editZoomLevel})`;
                document.getElementById('editZoomValue').textContent = Math.round(editZoomLevel * 100) + '%';
            }
        }
    }
}

function showPhotoManager() {
    document.getElementById('overlay').style.display = 'block';
    document.getElementById('photoModal').style.display = 'block';
    document.getElementById('adminPanel').style.display = 'none';
    loadPhotoManager();
}

function closePhotoModal() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('photoModal').style.display = 'none';
}

async function loadPhotoManager() {
    try {
        const snapshot = await database.ref('products').once('value');
        const products = snapshot.val();
        const content = document.getElementById('photoManagerContent');
        
        if (!products) {
            content.innerHTML = `
                <div style="text-align:center;color:#aaa;padding:20px;">
                    –¢–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
                </div>
            `;
            return;
        }
        
        let html = '';
        Object.entries(products).forEach(([productId, product]) => {
            const hasPhoto = product.photoUrl && product.photoUrl !== '';
            
            html += `
                <div style="
                    background: rgba(20,15,45,0.6);
                    border-radius: 10px;
                    padding: 15px;
                    margin-bottom: 10px;
                    border: 1px solid rgba(157,78,221,0.2);
                ">
                    <div style="display:flex;align-items:center;gap:15px;margin-bottom:10px;">
                        <div style="
                            width: 60px;
                            height: 60px;
                            border-radius: 8px;
                            overflow: hidden;
                            background: ${hasPhoto ? 'transparent' : 'rgba(157,78,221,0.1)'};
                            border: 1px solid rgba(157,78,221,0.3);
                        ">
                            ${hasPhoto 
                                ? `<img src="${product.photoUrl}" style="width:100%;height:100%;object-fit:cover;">`
                                : `<div style="display:flex;align-items:center;justify-content:center;height:100%;color:rgba(255,255,255,0.3);">üì∑</div>`
                            }
                        </div>
                        <div style="flex:1;">
                            <div style="font-weight:600;color:#fff;margin-bottom:5px;">${product.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</div>
                            <div style="font-size:0.85rem;color:#d0c0ff;">${product.flavor || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}</div>
                        </div>
                    </div>
                    
                    <div style="display:flex;gap:8px;">
                        <button onclick="uploadProductPhoto('${productId}')" style="
                            flex:1;
                            padding: 8px;
                            background: linear-gradient(45deg, #9d4edd, #6a00ff);
                            border: none;
                            border-radius: 6px;
                            color: white;
                            font-size: 0.85rem;
                            cursor: pointer;
                        ">${hasPhoto ? '–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ' : '–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ'}</button>
                        ${hasPhoto ? `
                        <button onclick="removeProductPhoto('${productId}')" style="
                            padding: 8px 12px;
                            background: linear-gradient(45deg, #ff4d4d, #d43f3f);
                            border: none;
                            border-radius: 6px;
                            color: white;
                            font-size: 0.85rem;
                            cursor: pointer;
                        ">–£–¥–∞–ª–∏—Ç—å</button>
                        ` : ''}
                    </div>
                </div>
            `;
        });
        
        content.innerHTML = html;
        
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ-–º–µ–Ω–µ–¥–∂–µ—Ä–∞:", error);
        content.innerHTML = `
            <div style="text-align:center;color:#ff4d4d;padding:20px;">
                –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
            </div>
        `;
    }
}

function uploadProductPhoto(productId) {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/jpeg,image/png';
    input.style.display = 'none';
    
    input.onchange = async (event) => {
        const file = event.target.files[0];
        if (!file) return;
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        const validTypes = ['image/jpeg', 'image/png'];
        const maxSize = 5 * 1024 * 1024;
        
        if (!validTypes.includes(file.type)) {
            showNotification('–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å JPG –∏–ª–∏ PNG', 'error');
            return;
        }
        
        if (file.size > maxSize) {
            showNotification('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5MB', 'error');
            return;
        }
        
        showNotification('‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏...', 'info', 5000);
        
        // –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –∫–∞–∫ Data URL
        const reader = new FileReader();
        reader.onload = async (e) => {
            try {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase –∫–∞–∫ —Å—Ç—Ä–æ–∫—É base64
                await database.ref('products/' + productId + '/photoUrl').set(e.target.result);
                
                showNotification('‚úÖ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞!', 'success');
                loadPhotoManager();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                const productItem = document.querySelector(`.product-item[data-id="${productId}"]`);
                if (productItem) {
                    const photoDiv = productItem.querySelector('.product-photo');
                    if (photoDiv) {
                        photoDiv.innerHTML = `<img src="${e.target.result}" alt="${productItem.dataset.name || '–¢–æ–≤–∞—Ä'}">`;
                    }
                }
                
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ:", error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏', 'error');
            }
        };
        
        reader.readAsDataURL(file);
    };
    
    document.body.appendChild(input);
    input.click();
    document.body.removeChild(input);
}

async function removeProductPhoto(productId) {
    if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é —Ç–æ–≤–∞—Ä–∞?')) return;
    
    try {
        await database.ref('products/' + productId + '/photoUrl').remove();
        showNotification('‚úÖ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —É–¥–∞–ª–µ–Ω–∞', 'success');
        loadPhotoManager();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
        const productItem = document.querySelector(`.product-item[data-id="${productId}"]`);
        if (productItem) {
            const photoDiv = productItem.querySelector('.product-photo');
            if (photoDiv) {
                photoDiv.innerHTML = '<div class="photo-placeholder">üì∑</div>';
            }
        }
        
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ:", error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏', 'error');
    }
}

// ====================== –ü–†–û–°–¢–ê–Ø –°–ò–°–¢–ï–ú–ê –ü–ê–†–û–õ–Ø 2610K ======================
function login() {
    const password = document.getElementById('adminPassword').value;
    
    if (!password) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å', 'error');
        return;
    }
    
    if (password === "2610K") {
        localStorage.setItem('isterika_admin', 'true');
        document.getElementById('loginBtn').style.display = 'none';
        document.getElementById('adminBtn').style.display = 'block';
        hideLoginForm();
        showNotification('‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
    } else {
        showNotification('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!', 'error');
        document.getElementById('adminPassword').value = '';
        document.getElementById('adminPassword').focus();
    }
}

function logout() {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
        localStorage.removeItem('isterika_admin');
        document.getElementById('loginBtn').style.display = 'block';
        document.getElementById('adminBtn').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'none';
        exitDeleteMode();
        exitEditMode();
        showNotification('üëã –í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'info');
    }
}

function checkAuth() {
    if (localStorage.getItem('isterika_admin') === 'true') {
        document.getElementById('loginBtn').style.display = 'none';
        document.getElementById('adminBtn').style.display = 'block';
    }
}

function showLoginForm() {
    document.getElementById('overlay').style.display = 'block';
    document.getElementById('loginForm').style.display = 'block';
    document.getElementById('adminPassword').focus();
}

function hideLoginForm() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('loginForm').style.display = 'none';
    document.getElementById('adminPassword').value = '';
}

function toggleAdminPanel() {
    const panel = document.getElementById('adminPanel');
    const isVisible = panel.style.display === 'block';
    
    closeAllModals();
    document.getElementById('loginForm').style.display = 'none';
    
    panel.style.display = isVisible ? 'none' : 'block';
}

// ====================== FIREBASE –§–£–ù–ö–¶–ò–ò ======================
function loadProducts() {
    try {
        if (productsRef) {
            productsRef.off();
        }
        
        productsRef = database.ref('products');
        
        productsRef.on('value', (snapshot) => {
            const products = snapshot.val();
            const container = document.getElementById('productsContainer');
            
            if (products) {
                const productsArray = Object.keys(products).map(productId => ({
                    id: productId,
                    ...products[productId]
                }));
                
                displayProducts(productsArray);
            } else {
                container.innerHTML = 
                    '<div style="grid-column:1/-1;color:#aaa;padding:40px;font-size:1.1rem;text-align:center;">–¢–æ–≤–∞—Ä–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç<br><small>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Ç–æ–≤–∞—Ä —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</small></div>';
            }
        });
        
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ Firebase:", error);
        document.getElementById('loadingText').innerHTML = 
            '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö';
    }
}

function displayProducts(productsArray) {
    const container = document.getElementById('productsContainer');
    container.innerHTML = '';
    
    const filteredProducts = currentFilter === 'all' 
        ? productsArray 
        : productsArray.filter(product => product.category === currentFilter);
    
    if (filteredProducts.length === 0) {
        container.innerHTML = 
            '<div style="grid-column:1/-1;color:#aaa;padding:40px;font-size:1.1rem;text-align:center;">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</div>';
        return;
    }
    
    filteredProducts.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
    
    filteredProducts.forEach(product => {
        container.appendChild(createProductElement(product, product.id));
    });
    
    restoreModes();
}

function restoreModes() {
    if (deleteMode) {
        enableDeleteMode();
    } else if (editMode) {
        enableEditMode();
    }
}

function createProductElement(product, productId) {
    const div = document.createElement('div');
    div.className = 'product-item';
    div.dataset.id = productId;
    div.dataset.category = product.category || 'other';
    div.dataset.name = product.name || '';
    
    const quantity = parseInt(product.quantity || 0);
    const quantityText = quantity === 0 ? '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏' : `–û—Å—Ç–∞–ª–æ—Å—å: ${quantity} —à—Ç.`;
    const quantityClass = quantity === 0 ? 'quantity-badge out-of-stock' : 'quantity-badge';
    
    const category = product.category || 'other';
    
    const originalPrice = parseFloat(product.price || 0);
    let finalPrice = originalPrice;
    let discountText = '';
    
    if (product.discount && product.discount > 0) {
        if (product.discountType === 'percent') {
            finalPrice = originalPrice * (1 - product.discount / 100);
            discountText = `-${product.discount}%`;
        } else if (product.discountType === 'fixed') {
            finalPrice = originalPrice - product.discount;
            discountText = `-${product.discount} BYN`;
        }
        finalPrice = Math.max(0, finalPrice);
    }
    
    // –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —Ç–æ–≤–∞—Ä–∞
    const photoDiv = document.createElement('div');
    photoDiv.className = 'product-photo';
    
    if (product.photoUrl && product.photoUrl !== '') {
        const img = document.createElement('img');
        img.src = product.photoUrl;
        img.alt = product.name || '–¢–æ–≤–∞—Ä';
        photoDiv.appendChild(img);
    } else {
        photoDiv.innerHTML = '<div class="photo-placeholder">üì∑</div>';
    }
    
    const contentDiv = document.createElement('div');
    contentDiv.className = 'product-content';
    
    // –ù–∞–∑–≤–∞–Ω–∏–µ (–±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
    const nameDiv = document.createElement('div');
    nameDiv.className = 'product-name';
    nameDiv.textContent = product.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
    
    // –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
    const dividerDiv = document.createElement('div');
    dividerDiv.className = 'content-divider';
    
    // –í–∫—É—Å/–û–ø–∏—Å–∞–Ω–∏–µ (–±–µ–∑ —Ä–∞–º–∫–∏)
    const flavorDiv = document.createElement('div');
    flavorDiv.className = 'product-flavor';
    
    switch(category) {
        case 'pod':
            flavorDiv.textContent = product.flavor || '–ë—Ä–µ–Ω–¥ –Ω–µ —É–∫–∞–∑–∞–Ω';
            break;
        case 'other':
            flavorDiv.textContent = product.flavor || '–¢–∏–ø –Ω–µ —É–∫–∞–∑–∞–Ω';
            break;
        default:
            flavorDiv.textContent = product.flavor || '–í–∫—É—Å –Ω–µ —É–∫–∞–∑–∞–Ω';
    }
    
    // –¶–µ–Ω–∞
    const priceDiv = document.createElement('div');
    priceDiv.className = 'product-price';
    
    if (product.discount && product.discount > 0) {
        const discountContainer = document.createElement('div');
        discountContainer.className = 'discount-price';
        
        const originalPriceSpan = document.createElement('span');
        originalPriceSpan.className = 'original-price';
        originalPriceSpan.textContent = originalPrice.toFixed(2);
        
        const finalPriceSpan = document.createElement('span');
        finalPriceSpan.className = 'price-number';
        finalPriceSpan.textContent = finalPrice.toFixed(2);
        
        const discountBadge = document.createElement('span');
        discountBadge.className = 'discount-badge';
        discountBadge.textContent = discountText;
        
        discountContainer.appendChild(originalPriceSpan);
        discountContainer.appendChild(finalPriceSpan);
        discountContainer.appendChild(discountBadge);
        priceDiv.appendChild(discountContainer);
    } else {
        const priceSpan = document.createElement('span');
        priceSpan.className = 'price-number';
        priceSpan.textContent = originalPrice.toFixed(2);
        priceDiv.appendChild(priceSpan);
    }
    
    // –û—Å—Ç–∞—Ç–æ–∫ - –ë–ï–õ–´–ô, –ñ–ò–†–ù–´–ô, –ë–ï–ó –†–ê–ú–ö–ò
    const quantityDiv = document.createElement('div');
    quantityDiv.className = quantityClass;
    quantityDiv.textContent = quantityText;
    
    // –ö–Ω–æ–ø–∫–∞ –ø–æ–∫—É–ø–∫–∏
    const buyBtn = document.createElement('button');
    buyBtn.className = 'buy-btn';
    buyBtn.onclick = (e) => {
        e.stopPropagation();
        showBuyModal(productId, category);
    };
    buyBtn.textContent = quantity === 0 ? '–ù–ï–¢ –í –ù–ê–õ–ò–ß–ò–ò' : '–ö–£–ü–ò–¢–¨';
    if (quantity === 0) buyBtn.disabled = true;
    
    // –°–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
    contentDiv.appendChild(nameDiv);
    contentDiv.appendChild(dividerDiv);
    contentDiv.appendChild(flavorDiv);
    contentDiv.appendChild(priceDiv);
    contentDiv.appendChild(quantityDiv);
    contentDiv.appendChild(buyBtn);
    
    // –°–±–æ—Ä–∫–∞ –≤—Å–µ–π –∫–∞—Ä—Ç–æ—á–∫–∏
    div.appendChild(photoDiv);
    div.appendChild(contentDiv);
    
    return div;
}

function updateFlavorPlaceholder() {
    const category = document.getElementById('productCategory').value;
    const input = document.getElementById('productFlavor');
    
    switch(category) {
        case 'pod':
            input.placeholder = '–ë—Ä–µ–Ω–¥';
            break;
        case 'other':
            input.placeholder = '–¢–∏–ø';
            break;
        default:
            input.placeholder = '–í–∫—É—Å/–û–ø–∏—Å–∞–Ω–∏–µ';
    }
}

function updateEditFlavorPlaceholder() {
    const category = document.getElementById('editProductCategory').value;
    const input = document.getElementById('editProductFlavor');
    
    switch(category) {
        case 'pod':
            input.placeholder = '–ë—Ä–µ–Ω–¥';
            break;
        case 'other':
            input.placeholder = '–¢–∏–ø';
            break;
        default:
            input.placeholder = '–í–∫—É—Å/–û–ø–∏—Å–∞–Ω–∏–µ';
    }
}

// ====================== –°–¢–ê–¢–ò–°–¢–ò–ö–ê ======================
async function showStatsModal() {
    document.getElementById('overlay').style.display = 'block';
    document.getElementById('statsModal').style.display = 'block';
    document.getElementById('adminPanel').style.display = 'none';
    
    await loadStats();
}

function closeStatsModal() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('statsModal').style.display = 'none';
}

async function loadStats() {
    try {
        const snapshot = await database.ref('products').once('value');
        const products = snapshot.val();
        
        const statsContent = document.getElementById('statsContent');
        
        if (!products) {
            statsContent.innerHTML = 
                '<div style="color:#aaa;padding:20px;text-align:center;">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</div>';
            return;
        }
        
        const productsArray = Object.values(products);
        const totalProducts = productsArray.length;
        
        // –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤
        const totalValue = productsArray.reduce((sum, p) => {
            const price = parseFloat(p.price) || 0;
            const quantity = parseInt(p.quantity) || 0;
            return sum + (price * quantity);
        }, 0);
        
        // –¢–æ–≤–∞—Ä—ã –±–µ–∑ —Å–∫–∏–¥–∫–∏ –∏ —Å–æ —Å–∫–∏–¥–∫–æ–π
        const withoutDiscount = productsArray.filter(p => !p.discount || p.discount <= 0).length;
        const withDiscount = totalProducts - withoutDiscount;
        
        // –¢–æ–≤–∞—Ä—ã –≤ –Ω–∞–ª–∏—á–∏–∏ –∏ –Ω–µ—Ç
        const inStock = productsArray.filter(p => {
            const quantity = parseInt(p.quantity) || 0;
            return quantity > 0;
        }).length;
        const outOfStock = totalProducts - inStock;
        
        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        const categories = {
            liquid: 0,
            pod: 0,
            snus: 0,
            other: 0
        };
        
        productsArray.forEach(product => {
            const cat = product.category || 'other';
            if (categories.hasOwnProperty(cat)) {
                categories[cat]++;
            }
        });
        
        // –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ 2 –∫–æ–ª–æ–Ω–∫–∏
        statsContent.innerHTML = `
            <div style="
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 15px;
                text-align: center;
            ">
                <div style="padding: 10px;">
                    <div style="color: #d0c0ff; font-size: 0.85rem; margin-bottom: 5px;">–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤</div>
                    <div style="color: #9d4edd; font-weight: 700; font-size: 1.2rem;">${totalProducts}</div>
                </div>
                
                <div style="padding: 10px;">
                    <div style="color: #d0c0ff; font-size: 0.85rem; margin-bottom: 5px;">–í –Ω–∞–ª–∏—á–∏–∏</div>
                    <div style="color: #38ef7d; font-weight: 700; font-size: 1.2rem;">${inStock}</div>
                </div>
                
                <div style="padding: 10px;">
                    <div style="color: #d0c0ff; font-size: 0.85rem; margin-bottom: 5px;">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</div>
                    <div style="color: #ff4d4d; font-weight: 700; font-size: 1.2rem;">${outOfStock}</div>
                </div>
                
                <div style="padding: 10px;">
                    <div style="color: #d0c0ff; font-size: 0.85rem; margin-bottom: 5px;">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</div>
                    <div style="color: #ffcc00; font-weight: 700; font-size: 1.1rem;">${totalValue.toFixed(2)} BYN</div>
                </div>
                
                <div style="padding: 10px;">
                    <div style="color: #d0c0ff; font-size: 0.85rem; margin-bottom: 5px;">–°–æ —Å–∫–∏–¥–∫–æ–π</div>
                    <div style="color: #ff4d8d; font-weight: 700; font-size: 1.2rem;">${withDiscount}</div>
                </div>
                
                <div style="padding: 10px;">
                    <div style="color: #d0c0ff; font-size: 0.85rem; margin-bottom: 5px;">–ë–µ–∑ —Å–∫–∏–¥–∫–∏</div>
                    <div style="color: #00b4db; font-weight: 700; font-size: 1.2rem;">${withoutDiscount}</div>
                </div>
            </div>
            
            <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(157,78,221,0.3);">
                <div style="color: #fff; font-weight: 600; margin-bottom: 10px; font-size: 0.9rem;">–ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:</div>
                <div style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 8px;
                    font-size: 0.85rem;
                ">
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #d0c0ff;">–ñ–∏–¥–∫–æ—Å—Ç–∏:</span>
                        <span style="color: #fff; font-weight: 600;">${categories.liquid}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #d0c0ff;">–ü–æ–¥-—Å–∏—Å—Ç–µ–º—ã:</span>
                        <span style="color: #fff; font-weight: 600;">${categories.pod}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #d0c0ff;">–°–Ω—é—Å:</span>
                        <span style="color: #fff; font-weight: 600;">${categories.snus}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #d0c0ff;">–†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏:</span>
                        <span style="color: #fff; font-weight: 600;">${categories.other}</span>
                    </div>
                </div>
            </div>
        `;
        
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:", error);
        document.getElementById('statsContent').innerHTML = 
            '<div style="text-align:center;padding:20px;color:#ff4d4d;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</div>';
    }
}

// ====================== –î–û–ë–ê–í–õ–ï–ù–ò–ï –¢–û–í–ê–†–ê ======================
async function addProduct() {
    if (isOperationInProgress) return;
    
    const submitBtn = document.querySelector('#addModal .confirm-modal-btn');
    const originalText = submitBtn.textContent;
    
    const name = document.getElementById('productName').value.trim();
    const flavor = document.getElementById('productFlavor').value.trim();
    const category = document.getElementById('productCategory').value;
    const priceInput = document.getElementById('productPrice').value;
    const discountInput = document.getElementById('productDiscount').value;
    const discountType = document.getElementById('discountType').value;
    const quantityInput = document.getElementById('productQuantity').value;
    
    if (!name) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞', 'error');
        return;
    }
    
    if (!flavor) {
        const placeholder = document.getElementById('productFlavor').placeholder;
        showNotification(`–í–≤–µ–¥–∏—Ç–µ ${placeholder.toLowerCase()}`, 'error');
        return;
    }
    
    if (!category) {
        showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é', 'error');
        return;
    }
    
    let price = parseFloat(priceInput);
    if (isNaN(price) || price < 0) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É', 'error');
        return;
    }
    
    if (price > 10000) {
        showNotification('–¶–µ–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 10 000 BYN', 'error');
        return;
    }
    
    let discount = parseFloat(discountInput) || 0;
    if (discount < 0 || discount > 99) {
        showNotification('–°–∫–∏–¥–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 0 –¥–æ 99%', 'error');
        return;
    }
    
    if (discountType === 'fixed' && discount >= price) {
        showNotification('–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∫–∏–¥–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–∞ —Ü–µ–Ω–µ', 'error');
        return;
    }
    
    let quantity = parseInt(quantityInput);
    if (isNaN(quantity) || quantity < 0) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ', 'error');
        return;
    }
    
    if (quantity > 10000) {
        showNotification('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 10 000', 'error');
        return;
    }
    
    isOperationInProgress = true;
    submitBtn.textContent = '–î–æ–±–∞–≤–ª—è–µ–º...';
    submitBtn.disabled = true;
    
    const newProduct = {
        name: name,
        flavor: flavor,
        category: category,
        price: price.toFixed(2),
        quantity: quantity,
        createdAt: Date.now()
    };
    
    if (discount > 0) {
        newProduct.discount = discount;
        newProduct.discountType = discountType;
    }
    
    // –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–æ—Ç–æ, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ
    if (currentPhotoFile) {
        const reader = new FileReader();
        reader.onload = async (e) => {
            newProduct.photoUrl = e.target.result;
            await saveProduct(newProduct);
        };
        reader.readAsDataURL(currentPhotoFile);
    } else {
        await saveProduct(newProduct);
    }
    
    async function saveProduct(productData) {
        try {
            await database.ref('products').push(productData);
            closeAddModal();
            showNotification('‚úÖ –¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
            filterProducts(currentFilter);
        } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:", error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞', 'error');
        } finally {
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
            isOperationInProgress = false;
            currentPhotoFile = null;
            addZoomLevel = 1;
        }
    }
}

function closeAddModal() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('addModal').style.display = 'none';
    
    ['productName', 'productFlavor', 'productPrice', 'productQuantity', 'productDiscount'].forEach(id => {
        document.getElementById(id).value = '';
    });
    document.getElementById('productCategory').selectedIndex = 0;
    document.getElementById('discountType').selectedIndex = 0;
    document.getElementById('addPhotoPreviewContainer').innerHTML = '<div class="photo-placeholder-icon">üì∑</div>';
    document.getElementById('addPhotoError').style.display = 'none';
    document.getElementById('addZoomControls').style.display = 'none';
    currentPhotoFile = null;
    addZoomLevel = 1;
}

function showAddModal() {
    document.getElementById('overlay').style.display = 'block';
    document.getElementById('addModal').style.display = 'block';
    document.getElementById('adminPanel').style.display = 'none';
    updateFlavorPlaceholder();
}

// ====================== –§–ò–õ–¨–¢–†–ê–¶–ò–Ø ======================
function filterProducts(category) {
    currentFilter = category;
    
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    event.target.classList.add('active');
    
    if (productsRef) {
        productsRef.once('value').then((snapshot) => {
            const products = snapshot.val();
            if (products) {
                const productsArray = Object.keys(products).map(productId => ({
                    id: productId,
                    ...products[productId]
                }));
                displayProducts(productsArray);
            }
        });
    }
}

// ====================== –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï ======================
function startEditMode() {
    editMode = true;
    deleteMode = false;
    document.getElementById('adminPanel').style.display = 'none';
    document.getElementById('exitEditBtn').style.display = 'block';
    document.getElementById('exitDeleteBtn').style.display = 'none';
    
    enableEditMode();
}

function enableEditMode() {
    document.querySelectorAll('.product-item').forEach(item => {
        item.classList.remove('delete-mode');
        item.classList.add('edit-mode');
        item.onclick = function(e) {
            if (isOperationInProgress) return;
            if (e.target.classList.contains('buy-btn') || e.target.closest('.buy-btn')) return;
            handleProductEdit(this);
        };
    });
}

function exitEditMode() {
    editMode = false;
    document.getElementById('exitEditBtn').style.display = 'none';
    
    document.querySelectorAll('.product-item').forEach(item => {
        item.classList.remove('edit-mode');
        item.onclick = null;
    });
}

async function handleProductEdit(product) {
    if (!editMode || isOperationInProgress) return;
    
    currentProductId = product.dataset.id;
    
    try {
        const snapshot = await database.ref('products/' + currentProductId).once('value');
        const productData = snapshot.val();
        
        if (!productData) return;
        
        document.getElementById('editProductName').value = productData.name || '';
        document.getElementById('editProductFlavor').value = productData.flavor || '';
        document.getElementById('editProductPrice').value = productData.price || '';
        document.getElementById('editProductQuantity').value = productData.quantity || '';
        document.getElementById('editProductDiscount').value = productData.discount || '';
        
        const categorySelect = document.getElementById('editProductCategory');
        categorySelect.value = productData.category || 'other';
        updateEditFlavorPlaceholder();
        
        const discountTypeSelect = document.getElementById('editDiscountType');
        discountTypeSelect.value = productData.discountType || 'percent';
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ö–û–î
        const photoPreviewContainer = document.getElementById('editPhotoPreviewContainer');
        const zoomControls = document.getElementById('editZoomControls');
        
        if (productData.photoUrl && productData.photoUrl !== '') {
            const img = document.createElement('img');
            img.src = productData.photoUrl;
            img.className = 'photo-preview';
            img.id = 'editPhotoPreview';
            img.style.transform = `scale(${editZoomLevel})`;
            
            photoPreviewContainer.innerHTML = '';
            photoPreviewContainer.appendChild(img);
            
            zoomControls.style.display = 'flex';
            document.getElementById('editZoomValue').textContent = Math.round(editZoomLevel * 100) + '%';
        } else {
            photoPreviewContainer.innerHTML = '<div class="photo-placeholder-icon">üì∑</div>';
            zoomControls.style.display = 'none';
        }
        
        currentEditPhotoFile = null;
        editZoomLevel = 1;
        
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('editModal').style.display = 'block';
        
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–∞:", error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–∞', 'error');
    }
}

async function saveProductEdit() {
    if (isOperationInProgress) return;
    
    const submitBtn = document.querySelector('#editModal .confirm-modal-btn');
    const originalText = submitBtn.textContent;
    
    const name = document.getElementById('editProductName').value.trim();
    const flavor = document.getElementById('editProductFlavor').value.trim();
    const category = document.getElementById('editProductCategory').value;
    const priceInput = document.getElementById('editProductPrice').value;
    const discountInput = document.getElementById('editProductDiscount').value;
    const discountType = document.getElementById('editDiscountType').value;
    const quantityInput = document.getElementById('editProductQuantity').value;
    
    if (!name) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞', 'error');
        return;
    }
    
    if (!flavor) {
        const placeholder = document.getElementById('editProductFlavor').placeholder;
        showNotification(`–í–≤–µ–¥–∏—Ç–µ ${placeholder.toLowerCase()}`, 'error');
        return;
    }
    
    let price = parseFloat(priceInput);
    if (isNaN(price) || price < 0) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É', 'error');
        return;
    }
    
    if (price > 10000) {
        showNotification('–¶–µ–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 10 000 BYN', 'error');
        return;
    }
    
    let discount = parseFloat(discountInput) || 0;
    if (discount < 0 || discount > 99) {
        showNotification('–°–∫–∏–¥–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 0 –¥–æ 99%', 'error');
        return;
    }
    
    if (discountType === 'fixed' && discount >= price) {
        showNotification('–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∫–∏–¥–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–∞ —Ü–µ–Ω–µ', 'error');
        return;
    }
    
    let quantity = parseInt(quantityInput);
    if (isNaN(quantity) || quantity < 0) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ', 'error');
        return;
    }
    
    if (quantity > 10000) {
        showNotification('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 10 000', 'error');
        return;
    }
    
    isOperationInProgress = true;
    submitBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
    submitBtn.disabled = true;
    
    const updatedProduct = {
        name: name,
        flavor: flavor,
        category: category,
        price: price.toFixed(2),
        quantity: quantity,
        updatedAt: Date.now()
    };
    
    if (discount > 0) {
        updatedProduct.discount = discount;
        updatedProduct.discountType = discountType;
    } else {
        updatedProduct.discount = null;
        updatedProduct.discountType = null;
    }
    
    // –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–æ–≤–æ–µ —Ñ–æ—Ç–æ, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ
    if (currentEditPhotoFile) {
        const reader = new FileReader();
        reader.onload = async (e) => {
            updatedProduct.photoUrl = e.target.result;
            await updateProduct(updatedProduct);
        };
        reader.readAsDataURL(currentEditPhotoFile);
    } else {
        await updateProduct(updatedProduct);
    }
    
    async function updateProduct(productData) {
        try {
            await database.ref('products/' + currentProductId).update(productData);
            closeEditModal();
            showNotification('‚úÖ –¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!', 'success');
        } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:", error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞', 'error');
        } finally {
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
            isOperationInProgress = false;
            currentEditPhotoFile = null;
            editZoomLevel = 1;
        }
    }
}

function closeEditModal() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('editModal').style.display = 'none';
    currentProductId = null;
    currentEditPhotoFile = null;
    editZoomLevel = 1;
}

// ====================== –ü–û–ö–£–ü–ö–ê ======================
async function showBuyModal(productId, category) {
    try {
        const snapshot = await database.ref('products/' + productId).once('value');
        const product = snapshot.val();
        
        if (!product || product.quantity === 0) {
            showNotification('‚ö†Ô∏è –¢–æ–≤–∞—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç', 'warning');
            return;
        }
        
        const categoryNames = {
            liquid: "–ñ–∏–¥–∫–æ—Å—Ç—å",
            pod: "–ü–æ–¥-—Å–∏—Å—Ç–µ–º–∞",
            snus: "–°–Ω—é—Å",
            other: "–†–∞—Å—Ö–æ–¥–Ω–∏–∫"
        };
        
        const categoryName = categoryNames[product.category] || '–î—Ä—É–≥–æ–µ';
        
        let finalPrice = parseFloat(product.price || 0);
        if (product.discount && product.discount > 0) {
            if (product.discountType === 'percent') {
                finalPrice = finalPrice * (1 - product.discount / 100);
            } else if (product.discountType === 'fixed') {
                finalPrice = finalPrice - product.discount;
            }
            finalPrice = Math.max(0, finalPrice);
        }
        
        orderText = `üì¶ –ó–∞–∫–∞–∑:\n\n` +
                   `–¢–æ–≤–∞—Ä: ${product.name}\n` +
                   `–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${categoryName}\n`;
        
        if (product.category === 'pod') {
            orderText += `–ë—Ä–µ–Ω–¥: ${product.flavor}\n`;
        } else if (product.category === 'other') {
            orderText += `–¢–∏–ø: ${product.flavor}\n`;
        } else {
            orderText += `–í–∫—É—Å: ${product.flavor}\n`;
        }
        
        if (product.discount && product.discount > 0) {
            orderText += `–¶–µ–Ω–∞: ${finalPrice.toFixed(2)} BYN (—Å–∫–∏–¥–∫–∞ ${product.discount}${product.discountType === 'percent' ? '%' : ' BYN'})\n`;
        } else {
            orderText += `–¶–µ–Ω–∞: ${finalPrice.toFixed(2)} BYN\n`;
        }
        
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('buyModal').style.display = 'block';
        document.getElementById('orderText').textContent = orderText;
        
        const orderBlock = document.getElementById('orderTextBlock');
        orderBlock.onclick = function() {
            if (!navigator.clipboard) {
                const textArea = document.createElement('textarea');
                textArea.value = orderText;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showNotification('‚úÖ –¢–µ–∫—Å—Ç –∑–∞–∫–∞–∑–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!', 'success');
                } catch (err) {
                    showNotification('‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
                }
                document.body.removeChild(textArea);
                return;
            }
            
            navigator.clipboard.writeText(orderText).then(() => {
                this.style.background = 'linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(46, 125, 50, 0.2))';
                this.style.borderColor = '#4CAF50';
                this.querySelector('.order-text').style.color = '#9dff9d';
                
                setTimeout(() => {
                    this.style.background = '';
                    this.style.borderColor = '';
                    this.querySelector('.order-text').style.color = '';
                }, 1500);
                
                showNotification('‚úÖ –¢–µ–∫—Å—Ç –∑–∞–∫–∞–∑–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!', 'success');
            }).catch(err => {
                showNotification('‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
            });
        };
        
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞:", error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–∞', 'error');
    }
}

function closeBuyModal() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('buyModal').style.display = 'none';
}

// ====================== –£–î–ê–õ–ï–ù–ò–ï ======================
function startDeleteMode() {
    deleteMode = true;
    editMode = false;
    document.getElementById('adminPanel').style.display = 'none';
    document.getElementById('exitDeleteBtn').style.display = 'block';
    document.getElementById('exitEditBtn').style.display = 'none';
    
    enableDeleteMode();
}

function enableDeleteMode() {
    document.querySelectorAll('.product-item').forEach(item => {
        item.classList.remove('edit-mode');
        item.classList.add('delete-mode');
        item.onclick = function(e) {
            if (isOperationInProgress) return;
            if (e.target.classList.contains('buy-btn') || e.target.closest('.buy-btn')) return;
            handleProductDeletion(this);
        };
    });
}

function exitDeleteMode() {
    deleteMode = false;
    document.getElementById('exitDeleteBtn').style.display = 'none';
    
    document.querySelectorAll('.product-item').forEach(item => {
        item.classList.remove('delete-mode');
        item.onclick = null;
    });
}

async function handleProductDeletion(product) {
    if (!deleteMode || isOperationInProgress) return;
    
    productToDelete = product;
    currentProductId = product.dataset.id;
    
    const snapshot = await database.ref('products/' + currentProductId).once('value');
    const productData = snapshot.val();
    
    if (!productData) return;
    
    const name = productData.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
    const flavor = productData.flavor || '';
    
    document.getElementById('overlay').style.display = 'block';
    document.getElementById('deleteModal').style.display = 'block';
    document.getElementById('deleteProductInfo').innerHTML = 
        `–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?<br><br><strong style="color:#fff;">${name}</strong><br>${flavor}`;
}

function cancelDelete() {
    closeDeleteModal();
}

async function confirmDelete() {
    if (!currentProductId || isOperationInProgress) return;
    
    const submitBtn = document.querySelector('#deleteModal .confirm-modal-btn');
    const originalText = submitBtn.textContent;
    
    submitBtn.textContent = '–£–¥–∞–ª–µ–Ω–∏–µ...';
    submitBtn.disabled = true;
    isOperationInProgress = true;
    
    try {
        await database.ref('products/' + currentProductId).remove();
        
        closeDeleteModal();
        showNotification('‚úÖ –¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!', 'success');
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:", error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞', 'error');
    } finally {
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
        isOperationInProgress = false;
    }
}

function closeDeleteModal() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('deleteModal').style.display = 'none';
    productToDelete = null;
    currentProductId = null;
}

function closeAllModals() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('addModal').style.display = 'none';
    document.getElementById('editModal').style.display = 'none';
    document.getElementById('deleteModal').style.display = 'none';
    document.getElementById('buyModal').style.display = 'none';
    document.getElementById('loginForm').style.display = 'none';
    document.getElementById('statsModal').style.display = 'none';
    document.getElementById('backupModal').style.display = 'none';
    document.getElementById('backupMenuModal').style.display = 'none';
    document.getElementById('photoModal').style.display = 'none';
    productToDelete = null;
    currentProductId = null;
    currentPhotoFile = null;
    currentEditPhotoFile = null;
    addZoomLevel = 1;
    editZoomLevel = 1;
}

// ====================== –†–ï–ó–ï–†–í–ù–û–ï –ö–û–ü–ò–†–û–í–ê–ù–ò–ï (–±–µ–∑ –≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç) ======================
async function createBackup() {
    try {
        const snapshot = await database.ref('products').once('value');
        const products = snapshot.val();
        
        if (!products) return null;
        
        const backupData = {
            timestamp: Date.now(),
            date: new Date().toISOString(),
            count: Object.keys(products).length,
            data: products
        };
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∫–æ–ø–∏–π)
        const backups = JSON.parse(localStorage.getItem('isterika_backups') || '[]');
        backups.unshift(backupData);
        
        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∫–æ–ø–∏–π
        if (backups.length > 5) {
            backups.pop();
        }
        
        localStorage.setItem('isterika_backups', JSON.stringify(backups));
        
        console.log('‚úÖ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞:', backupData.count, '—Ç–æ–≤–∞—Ä–æ–≤');
        return backupData;
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:', error);
        return null;
    }
}

// ====================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –†–ï–ó–ï–†–í–ù–´–ú–ò –ö–û–ü–ò–Ø–ú–ò (–±–µ–∑ –≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç) ======================
function showBackupMenu() {
    document.getElementById('overlay').style.display = 'block';
    document.getElementById('backupMenuModal').style.display = 'block';
    document.getElementById('adminPanel').style.display = 'none';
}

function closeBackupMenu() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('backupMenuModal').style.display = 'none';
}

function showBackupManager() {
    document.getElementById('overlay').style.display = 'block';
    document.getElementById('backupModal').style.display = 'block';
    document.getElementById('backupMenuModal').style.display = 'none';
    loadBackupList();
}

function closeBackupModal() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('backupModal').style.display = 'none';
}

function loadBackupList() {
    const backups = JSON.parse(localStorage.getItem('isterika_backups') || '[]');
    const backupList = document.getElementById('backupList');
    
    if (backups.length === 0) {
        backupList.innerHTML = `
            <div style="text-align:center;color:#aaa;padding:20px;">
                –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
            </div>
        `;
        return;
    }
    
    let html = '';
    backups.forEach((backup, index) => {
        const date = new Date(backup.timestamp);
        const formattedDate = date.toLocaleString('ru-RU');
        
        html += `
            <div style="
                background: rgba(20,15,45,0.6);
                border-radius: 8px;
                padding: 12px;
                margin-bottom: 10px;
                border: 1px solid rgba(157,78,221,0.2);
            ">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                    <div style="font-weight:600;color:#fff;">–ö–æ–ø–∏—è #${index + 1}</div>
                    <div style="font-size:0.8rem;color:#9d4edd;">${backup.count} —Ç–æ–≤–∞—Ä–æ–≤</div>
                </div>
                <div style="font-size:0.8rem;color:#d0c0ff;margin-bottom:8px;text-align:center;">
                    ${formattedDate}
                </div>
                <div style="display:flex;gap:8px;">
                    <button onclick="restoreBackup(${index})" style="
                        flex:1;
                        padding: 8px;
                        background: linear-gradient(45deg, #00b4db, #0083b0);
                        border: none;
                        border-radius: 6px;
                        color: white;
                        font-size: 0.85rem;
                        cursor: pointer;
                    ">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                    <button onclick="exportBackup(${index})" style="
                        flex:1;
                        padding: 8px;
                        background: linear-gradient(45deg, #38ef7d, #11998e);
                        border: none;
                        border-radius: 6px;
                        color: white;
                        font-size: 0.85rem;
                        cursor: pointer;
                    ">–≠–∫—Å–ø–æ—Ä—Ç</button>
                </div>
            </div>
        `;
    });
    
    backupList.innerHTML = html;
}

async function createManualBackup() {
    const backup = await createBackup();
    if (backup) {
        showNotification(`‚úÖ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞ (${backup.count} —Ç–æ–≤–∞—Ä–æ–≤)`, 'success');
        loadBackupList();
    }
}

async function restoreBackup(index) {
    const backups = JSON.parse(localStorage.getItem('isterika_backups') || '[]');
    if (!backups[index]) return;
    
    const backup = backups[index];
    
    if (!confirm(`–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –æ—Ç ${new Date(backup.timestamp).toLocaleString()}?\n\n–≠—Ç–æ –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç –í–°–ï —Ç–µ–∫—É—â–∏–µ —Ç–æ–≤–∞—Ä—ã!`)) {
        return;
    }
    
    try {
        // –û—á–∏—â–∞–µ–º –≤—Å–µ —Ç–µ–∫—É—â–∏–µ —Ç–æ–≤–∞—Ä—ã
        await database.ref('products').remove();
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
        for (const [productId, productData] of Object.entries(backup.data)) {
            await database.ref('products/' + productId).set(productData);
        }
        
        showNotification(`‚úÖ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (${backup.count} —Ç–æ–≤–∞—Ä–æ–≤)`, 'success', 5000);
        closeBackupModal();
        closeBackupMenu();
        filterProducts(currentFilter);
        
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:", error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏', 'error');
    }
}

function exportBackup(index) {
    const backups = JSON.parse(localStorage.getItem('isterika_backups') || '[]');
    if (!backups[index]) return;
    
    const backup = backups[index];
    const dataStr = JSON.stringify(backup, null, 2);
    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
    
    const date = new Date(backup.timestamp);
    const fileName = `isterika-restore-${date.toISOString().split('T')[0]}.json`;
    
    const linkElement = document.createElement('a');
    linkElement.setAttribute('href', dataUri);
    linkElement.setAttribute('download', fileName);
    linkElement.click();
    
    showNotification('‚úÖ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞', 'success');
}

// ====================== –ó–ê–ì–†–£–ó–ö–ê ======================
window.addEventListener('DOMContentLoaded', function() {
    checkAuth();
    loadProducts();
    
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeAllModals();
            document.getElementById('adminPanel').style.display = 'none';
        }
    });
    
    document.addEventListener('click', function(e) {
        const adminPanel = document.getElementById('adminPanel');
        const adminBtn = document.getElementById('adminBtn');
        
        if (adminPanel && adminPanel.style.display === 'block' && 
            !adminPanel.contains(e.target) && 
            !adminBtn.contains(e.target)) {
            adminPanel.style.display = 'none';
        }
    });
    
    document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
    });
});

window.addEventListener('beforeunload', () => {
    if (productsRef) {
        productsRef.off();
    }
});
</script>
</body>
</html>