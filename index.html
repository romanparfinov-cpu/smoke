<!DOCTYPE html>
<html>
<head>
<title>ISTERIKA</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<style>
/* –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò */
body {
    margin: 0;
    min-height: 100vh;
    background: linear-gradient(135deg, #0f0c29, #302b63 30%, #9d4edd 70%, #3c096c);
    color: #fff;
    font-family: 'Segoe UI', Arial, sans-serif;
    text-align: center;
    position: relative;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    padding-top: 60px;
}

/* –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –ù–ê –°–ê–ô–¢–ï */
.notification {
    position: fixed;
    top: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(20, 15, 45, 0.95);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(157, 78, 221, 0.4);
    border-radius: 12px;
    padding: 15px 25px;
    z-index: 2000;
    display: none;
    align-items: center;
    gap: 15px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from { top: -100px; opacity: 0; }
    to { top: 80px; opacity: 1; }
}

.notification.success {
    border-color: #38ef7d;
    background: rgba(56, 239, 125, 0.1);
}

.notification.error {
    border-color: #ff4d4d;
    background: rgba(255, 77, 77, 0.1);
}

.notification.warning {
    border-color: #ffcc00;
    background: rgba(255, 204, 0, 0.1);
}

.notification-info {
    font-size: 0.9rem;
    color: #d0c0ff;
}

.close-notification {
    background: none;
    border: none;
    color: #fff;
    font-size: 1.2rem;
    cursor: pointer;
    padding: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background 0.3s;
}

.close-notification:hover {
    background: rgba(255, 255, 255, 0.1);
}

.header {
    padding-top: 2vh;
    padding-bottom: 2vh;
    position: relative;
    overflow: hidden;
    z-index: 10;
}

.header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, #9d4edd, transparent);
}

.magazine {
    font-size: 0.8rem;
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-bottom: 2px;
    color: #d0c0ff;
    font-weight: 300;
}

.title {
    font-size: clamp(2rem, 8vw, 3.5rem);
    font-weight: 900;
    letter-spacing: 6px;
    margin: 0;
    background: linear-gradient(45deg, #fff, #9d4edd);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 4px 20px rgba(157, 78, 221, 0.3);
}

.divider {
    width: min(250px, 70vw);
    height: 2px;
    background: linear-gradient(90deg, transparent, #9d4edd 20%, #ff4d8d 50%, #9d4edd 80%, transparent);
    margin: 12px auto;
    border-radius: 2px;
}

/* –ö–ù–û–ü–ö–ò –§–ò–õ–¨–¢–†–ê–¶–ò–ò */
.filter-container {
    display: flex;
    justify-content: center;
    gap: 8px;
    padding: 0 12px 15px;
    flex-wrap: wrap;
    max-width: 1400px;
    margin: 0 auto;
    position: relative;
    z-index: 10;
}

.filter-btn {
    padding: 8px 16px;
    border: 1.5px solid rgba(157, 78, 221, 0.4);
    border-radius: 20px;
    background: rgba(20, 15, 45, 0.8);
    color: #d0c0ff;
    font-weight: 600;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(10px);
    letter-spacing: 0.5px;
    min-width: 90px;
}

.filter-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 10px rgba(157, 78, 221, 0.3);
}

.filter-btn.active {
    background: linear-gradient(45deg, #9d4edd, #6a00ff);
    color: white;
    border-color: #9d4edd;
    box-shadow: 0 3px 15px rgba(157, 78, 221, 0.4);
}

/* –ö–û–ù–¢–ï–ô–ù–ï–† –¢–û–í–ê–†–û–í */
.products {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    padding: 12px 12px 80px;
    max-width: 1400px;
    margin: 0 auto;
    box-sizing: border-box;
}

/* –ö–û–ú–ü–ê–ö–¢–ù–ê–Ø –ö–ê–†–¢–û–ß–ö–ê –¢–û–í–ê–†–ê */
.product-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 14px;
    border: 1px solid rgba(157, 78, 221, 0.3);
    padding: 12px 10px;
    display: flex;
    flex-direction: column;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(8px);
    min-height: 180px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.product-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(157, 78, 221, 0.5), transparent);
}

.product-item:hover {
    transform: translateY(-3px);
    border-color: #9d4edd;
    box-shadow: 0 8px 20px rgba(157, 78, 221, 0.25);
    background: rgba(255, 255, 255, 0.08);
}

.product-item.delete-mode {
    border: 2px solid #ffcc00;
    box-shadow: 0 0 15px rgba(255, 204, 0, 0.6);
    animation: pulse 2s infinite;
    cursor: pointer;
}

.product-item.edit-mode {
    border: 2px solid #00b4db;
    box-shadow: 0 0 15px rgba(0, 180, 219, 0.6);
    cursor: pointer;
}

/* –ö–û–ù–¢–ï–ù–¢ –ö–ê–†–¢–û–ß–ö–ò */
.product-content {
    display: flex;
    flex-direction: column;
    flex: 1;
    gap: 4px;
}

.product-name {
    font-size: 1rem;
    font-weight: 800;
    line-height: 1.2;
    min-height: 1.6em;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    margin: 0;
    padding: 0 3px;
}

/* –î–ï–ö–û–†–ê–¢–ò–í–ù–´–ô –†–ê–ó–î–ï–õ–ò–¢–ï–õ–¨ */
.content-divider {
    width: 100%;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(157, 78, 221, 0.4), transparent);
    margin: 2px 0 3px 0;
    border-radius: 1px;
}

/* –í–ö–£–°/–û–ü–ò–°–ê–ù–ò–ï */
.product-flavor {
    color: #d0c0ff;
    font-size: 0.9rem;
    font-weight: 500;
    line-height: 1.2;
    margin: 0;
    padding: 0;
    flex: 1;
    background: none;
    border: none;
    box-shadow: none;
    min-height: 1.3em;
}

/* –ö–†–ï–ü–û–°–¢–¨ - –±–µ–ª—ã–π –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç, —á—É—Ç—å –º–µ–Ω—å—à–µ –Ω–∞–∑–≤–∞–Ω–∏—è */
.product-strength {
    color: #ffffff;
    font-weight: 700;
    font-size: 0.9rem;
    margin: 2px 0;
}

/* –¶–ï–ù–ê */
.product-price {
    font-size: 1.2rem;
    font-weight: 800;
    color: #9dff9d;
    margin: 4px 0;
}

.discount-price {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    flex-wrap: wrap;
}

.original-price {
    text-decoration: line-through;
    color: #ff9999;
    font-size: 0.9rem;
    opacity: 0.7;
}

.discount-badge {
    background: linear-gradient(45deg, #ff3366, #ff4d8d);
    color: white;
    padding: 2px 6px;
    border-radius: 5px;
    font-size: 0.75rem;
    font-weight: 700;
}

.price-number::after {
    content: " BYN";
    font-size: 0.75em;
    opacity: 0.9;
    margin-left: 2px;
    font-weight: 600;
}

/* –û–°–¢–ê–¢–û–ö */
.quantity-badge {
    padding: 0;
    font-size: 0.8rem;
    font-weight: 700;
    display: inline-block;
    margin: 2px auto;
    width: fit-content;
    color: #fff;
    background: none;
    border: none;
}

.quantity-badge.out-of-stock {
    color: #ff4d4d;
}

.quantity-badge.reserved {
    color: #ffcc00;
}

/* –ö–ù–û–ü–ö–ò */
.buy-btn {
    padding: 8px 12px;
    background: linear-gradient(45deg, #9d4edd, #6a00ff);
    border: none;
    border-radius: 8px;
    color: white;
    font-weight: 700;
    cursor: pointer;
    width: 100%;
    box-sizing: border-box;
    margin-top: 6px;
    font-size: 0.85rem;
    letter-spacing: 0.5px;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
}

.buy-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: 0.5s;
}

.buy-btn:hover::before {
    left: 100%;
}

.buy-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 10px rgba(157, 78, 221, 0.4);
}

.buy-btn:active {
    transform: translateY(0);
}

.buy-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: linear-gradient(45deg, #666, #444);
}

/* –ö–ù–û–ü–ö–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø */
.login-btn-main, .admin-btn-main {
    padding: 10px 20px;
    background: linear-gradient(45deg, rgba(157, 78, 221, 0.9), rgba(106, 0, 255, 0.9));
    border: none;
    border-radius: 10px;
    color: white;
    font-weight: 700;
    cursor: pointer;
    font-size: 0.9rem;
    letter-spacing: 0.8px;
    transition: all 0.3s;
    position: fixed;
    z-index: 1000;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

.login-btn-main {
    top: 15px;
    left: 15px;
    min-width: 90px;
}

.admin-btn-main {
    top: 15px;
    right: 15px;
    min-width: 90px;
    display: none;
    position: fixed;
}

.login-btn-main:hover, .admin-btn-main:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(157, 78, 221, 0.4);
}

/* –§–û–†–ú–ê –õ–û–ì–ò–ù–ê */
.login-form {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20, 15, 45, 0.95);
    border-radius: 20px;
    padding: 30px 25px;
    z-index: 2000;
    width: min(350px, 90vw);
    display: none;
    backdrop-filter: blur(25px);
    border: 1px solid rgba(157, 78, 221, 0.3);
    box-shadow: 
        0 20px 40px -10px rgba(0, 0, 0, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    overflow: hidden;
}

.login-form::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, #9d4edd, transparent);
}

.login-form h3 {
    color: #fff;
    font-size: 1.6rem;
    margin: 0 0 25px 0;
    text-align: center;
    font-weight: 700;
    background: linear-gradient(45deg, #fff, #9d4edd);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.login-input-container {
    position: relative;
    margin-bottom: 20px;
}

.login-input-container input {
    width: 100%;
    padding: 14px 18px;
    background: rgba(255, 255, 255, 0.08);
    border: 2px solid rgba(157, 78, 221, 0.3);
    border-radius: 10px;
    color: #fff;
    font-size: 0.95rem;
    transition: all 0.3s;
    box-sizing: border-box;
}

.login-input-container input:focus {
    outline: none;
    border-color: #9d4edd;
    background: rgba(255, 255, 255, 0.12);
    box-shadow: 0 0 15px rgba(157, 78, 221, 0.3);
}

.login-input-container input::placeholder {
    color: rgba(255, 255, 255, 0.5);
}

.login-buttons {
    display: flex;
    gap: 12px;
    margin-top: 10px;
}

.login-btn, .cancel-login-btn {
    flex: 1;
    padding: 13px;
    border: none;
    border-radius: 10px;
    font-weight: 700;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s;
    letter-spacing: 0.8px;
}

.login-btn {
    background: linear-gradient(45deg, #9d4edd, #6a00ff);
    color: white;
}

.login-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(157, 78, 221, 0.4);
}

.cancel-login-btn {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    border: 2px solid rgba(157, 78, 221, 0.5);
}

.cancel-login-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

/* –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ */
.admin-panel {
    position: fixed;
    top: 60px;
    right: 15px;
    background: rgba(20, 15, 45, 0.95);
    border-radius: 14px;
    padding: 15px;
    z-index: 1000;
    display: none;
    backdrop-filter: blur(25px);
    border: 1px solid rgba(157, 78, 221, 0.3);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
    min-width: 220px;
    max-height: 80vh;
    overflow-y: auto;
}

.admin-panel h3 {
    color: #fff;
    margin: 0 0 12px 0;
    font-size: 1.2rem;
    text-align: center;
    font-weight: 700;
}

.admin-btn, .logout-btn {
    width: 100%;
    padding: 10px;
    margin: 4px 0;
    border: none;
    border-radius: 10px;
    font-weight: 700;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.3s;
}

.admin-btn {
    background: linear-gradient(45deg, #9d4edd, #6a00ff);
    color: white;
}

.admin-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(157, 78, 221, 0.4);
}

.admin-btn.edit-btn {
    background: linear-gradient(45deg, #00b4db, #0083b0);
}

.admin-btn.delete-btn {
    background: linear-gradient(45deg, #ff4d4d, #d43f3f);
}

.admin-btn.stats-btn {
    background: linear-gradient(45deg, #8e2de2, #4a00e0);
}

.logout-btn {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    border: 2px solid rgba(157, 78, 221, 0.3);
    margin-top: 10px;
    font-size: 0.85rem;
}

.logout-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

/* –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê */
.add-modal, .edit-modal, .stats-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20, 15, 45, 0.95);
    border-radius: 20px;
    padding: 25px 20px;
    z-index: 2000;
    width: min(420px, 95vw);
    display: none;
    backdrop-filter: blur(25px);
    border: 1px solid rgba(157, 78, 221, 0.3);
    box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.5);
}

.add-modal h3, .edit-modal h3, .stats-modal h3 {
    color: #fff;
    font-size: 1.5rem;
    margin: 0 0 20px 0;
    text-align: center;
    font-weight: 700;
}

.modal-input-container {
    position: relative;
    margin-bottom: 12px;
}

.modal-input-container input,
.modal-input-container select {
    width: 100%;
    padding: 12px 16px;
    background: rgba(255, 255, 255, 0.08);
    border: 2px solid rgba(157, 78, 221, 0.3);
    border-radius: 10px;
    color: #fff;
    font-size: 0.9rem;
    transition: all 0.3s;
    box-sizing: border-box;
}

.modal-input-container select {
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' fill='%239d4edd' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 16px center;
    background-size: 10px;
}

.modal-input-container input:focus,
.modal-input-container select:focus {
    outline: none;
    border-color: #9d4edd;
    background: rgba(255, 255, 255, 0.12);
    box-shadow: 0 0 12px rgba(157, 78, 221, 0.3);
}

.modal-input-container select option {
    background: #1a1a2e;
    color: #fff;
}

/* –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏–π */
.name-select {
    margin-bottom: 8px;
}

/* –ü–æ–ª–µ —Å–∫–∏–¥–∫–∏ */
.discount-container {
    margin-bottom: 12px;
}

.discount-input {
    width: 100%;
    padding: 12px 16px;
    background: rgba(255, 255, 255, 0.08);
    border: 2px solid rgba(157, 78, 221, 0.3);
    border-radius: 10px;
    color: #fff;
    font-size: 0.9rem;
    transition: all 0.3s;
    box-sizing: border-box;
}

.discount-input:focus {
    outline: none;
    border-color: #9d4edd;
    background: rgba(255, 255, 255, 0.12);
    box-shadow: 0 0 12px rgba(157, 78, 221, 0.3);
}

.discount-input::placeholder {
    color: rgba(255, 255, 255, 0.5);
}

.modal-buttons {
    display: flex;
    gap: 10px;
    margin-top: 8px;
}

.confirm-modal-btn, .cancel-modal-btn {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 10px;
    font-weight: 700;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s;
}

.confirm-modal-btn {
    background: linear-gradient(45deg, #9d4edd, #6a00ff);
    color: white;
}

.confirm-modal-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(157, 78, 221, 0.4);
}

.cancel-modal-btn {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    border: 2px solid rgba(157, 78, 221, 0.5);
}

.cancel-modal-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

/* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ü–û–ö–£–ü–ö–ò */
.buy-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20, 15, 45, 0.98);
    border-radius: 20px;
    padding: 25px 20px;
    z-index: 2000;
    width: min(350px, 90vw);
    display: none;
    backdrop-filter: blur(30px);
    border: 1px solid rgba(157, 78, 221, 0.4);
    box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.buy-modal h3 {
    color: #fff;
    font-size: 1.4rem;
    margin: 0 0 12px 0;
    text-align: center;
    font-weight: 700;
}

.order-text-block {
    background: linear-gradient(135deg, rgba(157, 78, 221, 0.1), rgba(106, 0, 255, 0.1));
    border: 2px solid rgba(157, 78, 221, 0.3);
    border-radius: 12px;
    padding: 16px;
    margin: 12px 0 16px;
    text-align: left;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
}

.order-text-block::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(157, 78, 221, 0.5), transparent);
}

.order-text-block:hover {
    background: linear-gradient(135deg, rgba(157, 78, 221, 0.15), rgba(106, 0, 255, 0.15));
    border-color: #9d4edd;
    transform: translateY(-2px);
}

.order-text {
    font-family: 'Courier New', monospace;
    color: #d0c0ff;
    font-size: 0.85rem;
    line-height: 1.4;
    white-space: pre-wrap;
    margin: 0;
}

.telegram-info {
    background: linear-gradient(135deg, rgba(0, 136, 204, 0.1), rgba(157, 78, 221, 0.1));
    border: 2px solid rgba(0, 136, 204, 0.3);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 16px;
    text-align: left;
}

.telegram-info a {
    display: flex;
    align-items: center;
    gap: 10px;
    text-decoration: none;
    color: inherit;
}

.telegram-icon {
    width: 40px;
    height: 40px;
    background: linear-gradient(45deg, #0088cc, #00aced);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    flex-shrink: 0;
}

.telegram-text {
    flex: 1;
}

.telegram-title {
    font-weight: 700;
    font-size: 0.95rem;
    margin-bottom: 2px;
    color: #fff;
}

.telegram-subtitle {
    color: #66ccff;
    font-size: 0.8rem;
    opacity: 0.9;
}

.close-buy-btn {
    width: 100%;
    padding: 12px;
    background: linear-gradient(45deg, #9d4edd, #6a00ff);
    border: none;
    border-radius: 10px;
    color: white;
    font-weight: 700;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s;
    letter-spacing: 0.6px;
}

.close-buy-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(157, 78, 221, 0.4);
}

.copy-info {
    text-align: center;
    margin-top: 6px;
    color: #66ccff;
    font-size: 0.75rem;
    font-style: italic;
    opacity: 0.8;
}

/* –û–í–ï–†–õ–ï–ô */
.overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.9);
    z-index: 1500;
    display: none;
    backdrop-filter: blur(5px);
}

/* –ö–ù–û–ü–ö–ò –í–´–•–û–î–ê –ò–ó –†–ï–ñ–ò–ú–û–í */
.exit-delete-btn {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 10px 24px;
    background: linear-gradient(45deg, #ff4d4d, #d43f3f);
    border: none;
    border-radius: 50px;
    color: white;
    font-weight: 700;
    cursor: pointer;
    z-index: 1000;
    display: none;
    font-size: 0.9rem;
    letter-spacing: 0.6px;
    box-shadow: 0 3px 12px rgba(255, 77, 77, 0.4);
    transition: all 0.3s;
}

.exit-edit-btn {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 10px 24px;
    background: linear-gradient(45deg, #00b4db, #0083b0);
    border: none;
    border-radius: 50px;
    color: white;
    font-weight: 700;
    cursor: pointer;
    z-index: 1000;
    display: none;
    font-size: 0.9rem;
    letter-spacing: 0.6px;
    box-shadow: 0 3px 12px rgba(0, 180, 219, 0.4);
    transition: all 0.3s;
}

.exit-delete-btn:hover, .exit-edit-btn:hover {
    transform: translateX(-50%) translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
}

/* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –°–¢–ê–¢–ò–°–¢–ò–ö–ò */
.stats-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20, 15, 45, 0.98);
    border-radius: 20px;
    padding: 20px;
    z-index: 2000;
    width: min(350px, 90vw);
    display: none;
    backdrop-filter: blur(30px);
    border: 1px solid rgba(157, 78, 221, 0.4);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
}

/* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –£–î–ê–õ–ï–ù–ò–Ø */
.add-modal.delete-modal {
    width: min(320px, 90vw);
}

/* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
@media (max-width: 480px) {
    body {
        padding-top: 50px;
    }
    
    .notification {
        top: 65px;
    }
    
    @keyframes slideDown {
        from { top: -100px; opacity: 0; }
        to { top: 65px; opacity: 1; }
    }
    
    .products {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        padding: 10px 8px 70px;
    }
    
    .product-item {
        min-height: 160px;
        padding: 10px 8px;
        border-radius: 12px;
    }
    
    .product-name {
        font-size: 0.95rem;
        min-height: 1.4em;
    }
    
    .product-flavor {
        font-size: 0.85rem;
        line-height: 1.1;
    }
    
    .product-price {
        font-size: 1.1rem;
        margin: 3px 0;
    }
    
    .buy-btn {
        padding: 7px 10px;
        font-size: 0.8rem;
        margin-top: 4px;
        border-radius: 6px;
    }
    
    .login-btn-main, .admin-btn-main {
        padding: 8px 16px;
        font-size: 0.85rem;
        top: 10px;
        left: 10px;
        right: 10px;
        min-width: 80px;
    }
    
    .admin-panel {
        top: 50px;
        right: 10px;
        min-width: 200px;
        padding: 12px;
        max-height: 70vh;
    }
    
    .admin-panel h3 {
        font-size: 1.1rem;
        margin-bottom: 10px;
    }
    
    .admin-btn, .logout-btn {
        padding: 8px;
        margin: 3px 0;
        font-size: 0.8rem;
    }
    
    .filter-container {
        gap: 5px;
        padding: 0 8px 10px;
    }
    
    .filter-btn {
        padding: 6px 12px;
        font-size: 0.78rem;
        min-width: 75px;
    }
    
    .login-form, .add-modal, .edit-modal, .buy-modal, .stats-modal {
        padding: 20px 15px;
    }
    
    .exit-delete-btn, .exit-edit-btn {
        padding: 8px 20px;
        font-size: 0.85rem;
        bottom: 15px;
    }
}

@media (min-width: 481px) and (max-width: 768px) {
    .products {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }
    
    .product-item {
        min-height: 170px;
    }
    
    .admin-panel {
        right: 10px;
        max-height: 75vh;
    }
}

@media (min-width: 769px) {
    .products {
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        padding: 15px 12px 90px;
    }
    
    .product-item {
        min-height: 190px;
    }
    
    .admin-panel {
        right: 15px;
    }
}

@media (min-width: 1200px) {
    .products {
        grid-template-columns: repeat(4, 1fr);
        gap: 18px;
        padding: 18px 15px 100px;
    }
    
    .product-item {
        min-height: 200px;
    }
}

@keyframes pulse {
    0% { box-shadow: 0 0 10px rgba(255, 204, 0, 0.5); }
    50% { box-shadow: 0 0 20px rgba(255, 204, 0, 0.9); }
    100% { box-shadow: 0 0 10px rgba(255, 204, 0, 0.5); }
}
</style>
</head>
<body>

<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–∞–π—Ç–∞ -->
<div class="notification" id="notification">
    <span class="notification-info" id="notificationText"></span>
    <button class="close-notification" onclick="closeNotification()">√ó</button>
</div>

<!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
<button class="login-btn-main" id="loginBtn" onclick="showLoginForm()">–í–æ–π—Ç–∏</button>
<button class="admin-btn-main" id="adminBtn" onclick="toggleAdminPanel()">–ê–¥–º–∏–Ω</button>

<!-- –ö—Ä–∞—Å–∏–≤–∞—è —Ñ–æ—Ä–º–∞ –ª–æ–≥–∏–Ω–∞ -->
<div class="login-form" id="loginForm">
    <h3>–í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∞</h3>
    <div class="login-input-container">
        <input type="password" id="adminPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="off">
    </div>
    <div class="login-buttons">
        <button class="login-btn" onclick="login()">–í–æ–π—Ç–∏</button>
        <button class="cancel-login-btn" onclick="hideLoginForm()">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>

<!-- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å -->
<div class="admin-panel" id="adminPanel">
    <h3>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h3>
    
    <button class="admin-btn" onclick="showAddModal()">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
    <button class="admin-btn edit-btn" onclick="startEditMode()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã</button>
    <button class="admin-btn delete-btn" onclick="startDeleteMode()">–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä—ã</button>
    <button class="admin-btn stats-btn" onclick="showStatsModal()">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
    <button class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
<div class="add-modal" id="addModal">
    <h3>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
    
    <div class="modal-input-container">
        <select id="productCategory" required onchange="updateAddForm()">
            <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
            <option value="liquid">–ñ–∏–¥–∫–æ—Å—Ç—å</option>
            <option value="pod">–ü–æ–¥-—Å–∏—Å—Ç–µ–º–∞</option>
            <option value="snus">–°–Ω—é—Å</option>
            <option value="other">–†–∞—Å—Ö–æ–¥–Ω–∏–∫</option>
        </select>
    </div>
    
    <div class="modal-input-container name-select" id="nameSelectContainer" style="display:none;">
        <select id="productNameSelect" onchange="updateNameFromSelect()">
            <option value="" selected>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</option>
        </select>
    </div>
    
    <div class="modal-input-container">
        <input type="text" id="productName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ (–∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –≤—Ä—É—á–Ω—É—é)" required>
    </div>
    
    <div class="modal-input-container">
        <input type="text" id="productFlavor" placeholder="–í–∫—É—Å/–ë—Ä–µ–Ω–¥/–¢–∏–ø" required>
    </div>
    
    <div class="modal-input-container" id="strengthContainer">
        <input type="text" id="productStrength" placeholder="–ö—Ä–µ–ø–æ—Å—Ç—å">
    </div>
    
    <div class="modal-input-container">
        <input type="number" id="productPrice" placeholder="–¶–µ–Ω–∞ (BYN)" min="0" step="0.01" required>
    </div>
    
    <div class="discount-container">
        <input type="number" class="discount-input" id="productDiscount" placeholder="–°–∫–∏–¥–∫–∞ –≤ BYN" min="0" step="0.01">
    </div>
    
    <div class="modal-input-container">
        <select id="productQuantity" required>
            <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ª–∏—á–∏–µ</option>
            <option value="1">1 —à—Ç</option>
            <option value="2">2 —à—Ç</option>
            <option value="3">3 —à—Ç</option>
            <option value="4">4 —à—Ç</option>
            <option value="5">5 —à—Ç</option>
            <option value="0">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</option>
            <option value="reserved">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ</option>
        </select>
    </div>
    
    <div class="modal-buttons">
        <button class="confirm-modal-btn" onclick="addProduct()">–î–æ–±–∞–≤–∏—Ç—å</button>
        <button class="cancel-modal-btn" onclick="closeAddModal()">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
<div class="edit-modal" id="editModal">
    <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä</h3>
    
    <div class="modal-input-container">
        <select id="editProductCategory" required onchange="updateEditForm()">
            <option value="liquid">–ñ–∏–¥–∫–æ—Å—Ç—å</option>
            <option value="pod">–ü–æ–¥-—Å–∏—Å—Ç–µ–º–∞</option>
            <option value="snus">–°–Ω—é—Å</option>
            <option value="other">–†–∞—Å—Ö–æ–¥–Ω–∏–∫</option>
        </select>
    </div>
    
    <div class="modal-input-container name-select" id="editNameSelectContainer" style="display:none;">
        <select id="editProductNameSelect" onchange="updateEditNameFromSelect()">
            <option value="" selected>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</option>
        </select>
    </div>
    
    <div class="modal-input-container">
        <input type="text" id="editProductName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" required>
    </div>
    
    <div class="modal-input-container">
        <input type="text" id="editProductFlavor" placeholder="–í–∫—É—Å/–ë—Ä–µ–Ω–¥/–¢–∏–ø" required>
    </div>
    
    <div class="modal-input-container" id="editStrengthContainer">
        <input type="text" id="editProductStrength" placeholder="–ö—Ä–µ–ø–æ—Å—Ç—å">
    </div>
    
    <div class="modal-input-container">
        <input type="number" id="editProductPrice" placeholder="–¶–µ–Ω–∞ (BYN)" min="0" step="0.01" required>
    </div>
    
    <div class="discount-container">
        <input type="number" class="discount-input" id="editProductDiscount" placeholder="–°–∫–∏–¥–∫–∞ –≤ BYN" min="0" step="0.01">
    </div>
    
    <div class="modal-input-container">
        <select id="editProductQuantity" required>
            <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ª–∏—á–∏–µ</option>
            <option value="1">1 —à—Ç</option>
            <option value="2">2 —à—Ç</option>
            <option value="3">3 —à—Ç</option>
            <option value="4">4 —à—Ç</option>
            <option value="5">5 —à—Ç</option>
            <option value="0">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</option>
            <option value="reserved">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ</option>
        </select>
    </div>
    
    <div class="modal-buttons">
        <button class="confirm-modal-btn" onclick="saveProductEdit()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="cancel-modal-btn" onclick="closeEditModal()">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
<div class="stats-modal" id="statsModal">
    <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞</h3>
    
    <div id="statsContent" style="
        background: rgba(20, 15, 45, 0.6);
        border-radius: 10px;
        padding: 15px;
        margin: 12px 0;
        border: 1px solid rgba(157, 78, 221, 0.3);
        text-align: center;
    ">
        <div style="color: #d0c0ff; font-size: 0.85rem; margin-bottom: 12px;">
            –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...
        </div>
    </div>
    
    <div class="modal-buttons">
        <button class="confirm-modal-btn" onclick="closeStatsModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∫—É–ø–∫–∏ -->
<div class="buy-modal" id="buyModal">
    <h3>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h3>
    <div class="order-text-block" id="orderTextBlock">
        <div class="order-text" id="orderText"></div>
    </div>
    <div class="copy-info">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ç–µ–∫—Å—Ç –≤—ã—à–µ, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</div>
    <div class="telegram-info">
        <a href="https://t.me/isterikaMngr" target="_blank">
            <div class="telegram-icon">‚úà</div>
            <div class="telegram-text">
                <div class="telegram-title">–°–≤—è–∂–∏—Ç–µ—Å—å –≤ Telegram</div>
                <div class="telegram-subtitle">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –Ω–∞–ø–∏—Å–∞—Ç—å @isterikaMngr</div>
            </div>
        </a>
    </div>
    <button class="close-buy-btn" onclick="closeBuyModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<!-- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ä–µ–∂–∏–º–∞ —É–¥–∞–ª–µ–Ω–∏—è -->
<button class="exit-delete-btn" id="exitDeleteBtn" onclick="exitDeleteMode()">‚úï –û—Ç–º–µ–Ω–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ</button>

<!-- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
<button class="exit-edit-btn" id="exitEditBtn" onclick="exitEditMode()">‚úï –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</button>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è -->
<div class="add-modal delete-modal" id="deleteModal">
    <h3>–£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</h3>
    <p id="deleteProductInfo" style="color: #d0c0ff; text-align: center; margin: 15px 0; font-size: 0.9rem;">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?</p>
    <div class="modal-buttons">
        <button class="confirm-modal-btn" onclick="confirmDelete()" style="background: linear-gradient(45deg, #ff4d4d, #d43f3f);">–£–¥–∞–ª–∏—Ç—å</button>
        <button class="cancel-modal-btn" onclick="cancelDelete()">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>

<!-- –û–≤–µ—Ä–ª–µ–π -->
<div class="overlay" id="overlay" onclick="closeAllModals()"></div>

<!-- –®–∞–ø–∫–∞ -->
<div class="header">
    <div class="magazine">–ú–∞–≥–∞–∑–∏–Ω</div>
    <div class="title">ISTERIKA</div>
    <div class="divider"></div>
</div>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<div class="filter-container" id="filterContainer">
    <button class="filter-btn active" onclick="filterProducts('all')">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</button>
    <button class="filter-btn" onclick="filterProducts('liquid')">–ñ–∏–¥–∫–æ—Å—Ç–∏</button>
    <button class="filter-btn" onclick="filterProducts('pod')">–ü–æ–¥-—Å–∏—Å—Ç–µ–º—ã</button>
    <button class="filter-btn" onclick="filterProducts('snus')">–°–Ω—é—Å</button>
    <button class="filter-btn" onclick="filterProducts('other')">–†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏</button>
</div>

<!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—è–º (–ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏) -->
<div class="filter-container" id="nameFilterContainer" style="display:none; padding-top:0;">
    <select id="nameFilter" onchange="filterByName()" style="
        padding: 8px 16px;
        border: 1.5px solid rgba(157, 78, 221, 0.4);
        border-radius: 20px;
        background: rgba(20, 15, 45, 0.8);
        color: #fff;
        font-weight: 600;
        font-size: 0.85rem;
        backdrop-filter: blur(10px);
        width: 100%;
        max-width: 300px;
    ">
        <option value="">–í–µ—Å—å —Ç–æ–≤–∞—Ä</option>
    </select>
</div>

<!-- –¢–æ–≤–∞—Ä—ã -->
<div class="products" id="productsContainer">
    <div style="grid-column:1/-1; padding: 30px; color: #aaa; font-size: 0.95rem;" id="loadingText">
        –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...
    </div>
</div>

<script>
// ====================== –ù–ê–°–¢–†–û–ô–ö–ê FIREBASE ======================
const firebaseConfig = {
  apiKey: "AIzaSyAKqapbYPKkvnp63IANSSDj5NBTITz49yk",
  authDomain: "smoke-shop-982fb.firebaseapp.com",
  databaseURL: "https://smoke-shop-982fb-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "smoke-shop-982fb",
  storageBucket: "smoke-shop-982fb.firebasestorage.app",
  messagingSenderId: "1037879903984",
  appId: "1:1037879903984:web:57b4269729cac1cc6a2435",
  measurementId: "G-NRB44ZW03M"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// ====================== –ü–ï–†–ï–ú–ï–ù–ù–´–ï ======================
let deleteMode = false;
let editMode = false;
let productToDelete = null;
let currentProductId = null;
let orderText = '';
let currentFilter = 'all';
let currentNameFilter = '';
let productsRef = null;
let isOperationInProgress = false;

// –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
const presetNames = {
    liquid: [
        "ISTERIKA –ì–†–ï–•",
        "–ì–†–ï–•",
        "ISTERIKA MIX",
        "–ú–û–ù–ê–®–ö–ê HOTSPOT",
        "–ó–õ–ê–Ø –ú–û–ù–ê–®–ö–ê",
        "–ó–õ–ê–Ø –ú–û–ù–ê–®–ö–ê ICE",
        "–ó–õ–ê–Ø –ú–û–ù–ê–®–ö–ê SOUR",
        "CATSWILL EXTRA"
    ],
    pod: [
        "XROS 5",
        "XROS 5 MINI",
        "XROS CUBE",
        "BRUSKO APX C1"
    ],
    snus: [
        "PODONKI SLICK",
        "ICEBERG",
        "ISTERIKA –ú–û–ù–ê–®–ö–ê",
        "FAFF",
        "ZUZU",
        "DRYMOST",
        "ODENS",
        "D.L.T.A"
    ],
    other: [] // –†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏ - —Ç–æ–ª—å–∫–æ —Ä—É—á–Ω–æ–π –≤–≤–æ–¥
};

// –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫—Ä–µ–ø–æ—Å—Ç—å
function getPresetStrength(name) {
    if (name.includes("–ó–õ–ê–Ø –ú–û–ù–ê–®–ö–ê") || name === "–ú–û–ù–ê–®–ö–ê HOTSPOT") {
        return "70mg";
    } else if (presetNames.liquid.includes(name)) {
        return "60mg";
    } else if (presetNames.snus.includes(name)) {
        return "60mg";
    }
    return "";
}

// ====================== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ======================
function showNotification(message, type = 'info', duration = 3000) {
    const notification = document.getElementById('notification');
    const notificationText = document.getElementById('notificationText');
    
    notificationText.textContent = message;
    notification.className = 'notification ' + type;
    notification.style.display = 'flex';
    
    if (duration > 0) {
        setTimeout(() => {
            notification.style.display = 'none';
        }, duration);
    }
}

function closeNotification() {
    document.getElementById('notification').style.display = 'none';
}

// –ø–∞—Ä–æ–ª—å
function login() {
    const password = document.getElementById('adminPassword').value;
    
    if (!password) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å', 'error');
        return;
    }
    
    if (password === "K26R10S06") {
        localStorage.setItem('isterika_admin', 'true');
        document.getElementById('loginBtn').style.display = 'none';
        document.getElementById('adminBtn').style.display = 'block';
        hideLoginForm();
        showNotification('‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
    } else {
        showNotification('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!', 'error');
        document.getElementById('adminPassword').value = '';
        document.getElementById('adminPassword').focus();
    }
}

function logout() {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
        localStorage.removeItem('isterika_admin');
        document.getElementById('loginBtn').style.display = 'block';
        document.getElementById('adminBtn').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'none';
        exitDeleteMode();
        exitEditMode();
        showNotification('üëã –í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'info');
    }
}

function checkAuth() {
    if (localStorage.getItem('isterika_admin') === 'true') {
        document.getElementById('loginBtn').style.display = 'none';
        document.getElementById('adminBtn').style.display = 'block';
    }
}

function showLoginForm() {
    document.getElementById('overlay').style.display = 'block';
    document.getElementById('loginForm').style.display = 'block';
    document.getElementById('adminPassword').focus();
}

function hideLoginForm() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('loginForm').style.display = 'none';
    document.getElementById('adminPassword').value = '';
}

function toggleAdminPanel() {
    const panel = document.getElementById('adminPanel');
    const isVisible = panel.style.display === 'block';
    
    closeAllModals();
    document.getElementById('loginForm').style.display = 'none';
    
    panel.style.display = isVisible ? 'none' : 'block';
}

// ====================== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –§–û–†–ú–´ –î–û–ë–ê–í–õ–ï–ù–ò–Ø ======================
function updateAddForm() {
    const category = document.getElementById('productCategory').value;
    const nameSelectContainer = document.getElementById('nameSelectContainer');
    const nameSelect = document.getElementById('productNameSelect');
    const nameInput = document.getElementById('productName');
    const flavorInput = document.getElementById('productFlavor');
    const strengthContainer = document.getElementById('strengthContainer');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –¥–ª—è –≤–∫—É—Å–∞/–æ–ø–∏—Å–∞–Ω–∏—è
    switch(category) {
        case 'pod':
            flavorInput.placeholder = '–û–ø–∏—Å–∞–Ω–∏–µ';
            break;
        case 'other':
            flavorInput.placeholder = '–¢–∏–ø';
            break;
        default:
            flavorInput.placeholder = '–í–∫—É—Å/–û–ø–∏—Å–∞–Ω–∏–µ';
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –Ω–∞–∑–≤–∞–Ω–∏–π
    if (category && presetNames[category] && presetNames[category].length > 0) {
        nameSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</option>';
        presetNames[category].forEach(name => {
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            nameSelect.appendChild(option);
        });
        nameSelectContainer.style.display = 'block';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –∫—Ä–µ–ø–æ—Å—Ç–∏ –¥–ª—è –∂–∏–¥–∫–æ—Å—Ç–µ–π –∏ —Å–Ω—é—Å–∞
        if (category === 'liquid' || category === 'snus') {
            strengthContainer.style.display = 'block';
        } else {
            // –î–ª—è –ø–æ–¥-—Å–∏—Å—Ç–µ–º —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –∫—Ä–µ–ø–æ—Å—Ç–∏
            strengthContainer.style.display = 'none';
            document.getElementById('productStrength').value = '';
        }
    } else {
        nameSelectContainer.style.display = 'none';
        // –î–ª—è —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –∫—Ä–µ–ø–æ—Å—Ç–∏
        if (category === 'other') {
            strengthContainer.style.display = 'none';
            document.getElementById('productStrength').value = '';
        } else if (category === 'pod') {
            strengthContainer.style.display = 'none';
            document.getElementById('productStrength').value = '';
        } else {
            strengthContainer.style.display = 'block';
        }
    }
    
    // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
    nameInput.value = '';
    flavorInput.value = '';
}

function updateNameFromSelect() {
    const category = document.getElementById('productCategory').value;
    const selectedName = document.getElementById('productNameSelect').value;
    const nameInput = document.getElementById('productName');
    const strengthInput = document.getElementById('productStrength');
    
    if (selectedName) {
        nameInput.value = selectedName;
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫—Ä–µ–ø–æ—Å—Ç—å –¥–ª—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π (—Ç–æ–ª—å–∫–æ –¥–ª—è –∂–∏–¥–∫–æ—Å—Ç–µ–π –∏ —Å–Ω—é—Å–∞)
        if (category === 'liquid' || category === 'snus') {
            const presetStrength = getPresetStrength(selectedName);
            if (presetStrength) {
                strengthInput.value = presetStrength;
            } else {
                strengthInput.value = '';
            }
        }
    }
}

// ====================== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –§–û–†–ú–´ –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø ======================
function updateEditForm() {
    const category = document.getElementById('editProductCategory').value;
    const nameSelectContainer = document.getElementById('editNameSelectContainer');
    const nameSelect = document.getElementById('editProductNameSelect');
    const nameInput = document.getElementById('editProductName');
    const flavorInput = document.getElementById('editProductFlavor');
    const strengthContainer = document.getElementById('editStrengthContainer');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –¥–ª—è –≤–∫—É—Å–∞/–æ–ø–∏—Å–∞–Ω–∏—è
    switch(category) {
        case 'pod':
            flavorInput.placeholder = '–û–ø–∏—Å–∞–Ω–∏–µ';
            break;
        case 'other':
            flavorInput.placeholder = '–¢–∏–ø';
            break;
        default:
            flavorInput.placeholder = '–í–∫—É—Å/–û–ø–∏—Å–∞–Ω–∏–µ';
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –Ω–∞–∑–≤–∞–Ω–∏–π
    if (category && presetNames[category] && presetNames[category].length > 0) {
        nameSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</option>';
        presetNames[category].forEach(name => {
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            nameSelect.appendChild(option);
        });
        nameSelectContainer.style.display = 'block';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –∫—Ä–µ–ø–æ—Å—Ç–∏ –¥–ª—è –∂–∏–¥–∫–æ—Å—Ç–µ–π –∏ —Å–Ω—é—Å–∞
        if (category === 'liquid' || category === 'snus') {
            strengthContainer.style.display = 'block';
        } else {
            // –î–ª—è –ø–æ–¥-—Å–∏—Å—Ç–µ–º —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –∫—Ä–µ–ø–æ—Å—Ç–∏
            strengthContainer.style.display = 'none';
            document.getElementById('editProductStrength').value = '';
        }
    } else {
        nameSelectContainer.style.display = 'none';
        // –î–ª—è —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –∫—Ä–µ–ø–æ—Å—Ç–∏
        if (category === 'other') {
            strengthContainer.style.display = 'none';
            document.getElementById('editProductStrength').value = '';
        } else if (category === 'pod') {
            strengthContainer.style.display = 'none';
            document.getElementById('editProductStrength').value = '';
        } else {
            strengthContainer.style.display = 'block';
        }
    }
}

function updateEditNameFromSelect() {
    const category = document.getElementById('editProductCategory').value;
    const selectedName = document.getElementById('editProductNameSelect').value;
    const nameInput = document.getElementById('editProductName');
    const strengthInput = document.getElementById('editProductStrength');
    
    if (selectedName) {
        nameInput.value = selectedName;
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫—Ä–µ–ø–æ—Å—Ç—å –¥–ª—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π (—Ç–æ–ª—å–∫–æ –¥–ª—è –∂–∏–¥–∫–æ—Å—Ç–µ–π –∏ —Å–Ω—é—Å–∞)
        if (category === 'liquid' || category === 'snus') {
            const presetStrength = getPresetStrength(selectedName);
            if (presetStrength) {
                strengthInput.value = presetStrength;
            }
        }
    }
}

// ====================== FIREBASE –§–£–ù–ö–¶–ò–ò ======================
function loadProducts() {
    try {
        if (productsRef) {
            productsRef.off();
        }
        
        productsRef = database.ref('products');
        
        productsRef.on('value', (snapshot) => {
            const products = snapshot.val();
            const container = document.getElementById('productsContainer');
            
            if (products) {
                const productsArray = Object.keys(products).map(productId => ({
                    id: productId,
                    ...products[productId]
                }));
                
                displayProducts(productsArray);
                updateNameFilter(productsArray);
            } else {
                container.innerHTML = 
                    '<div style="grid-column:1/-1;color:#aaa;padding:30px;font-size:0.95rem;text-align:center;">–¢–æ–≤–∞—Ä–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç<br><small style="font-size:0.85rem;">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Ç–æ–≤–∞—Ä —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</small></div>';
            }
        });
        
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ Firebase:", error);
        document.getElementById('loadingText').innerHTML = 
            '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö';
    }
}

function updateNameFilter(productsArray) {
    const nameFilter = document.getElementById('nameFilter');
    const currentProducts = currentFilter === 'all' 
        ? productsArray 
        : productsArray.filter(p => p.category === currentFilter);
    
    // –ü–æ–ª—É—á–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è
    const uniqueNames = [...new Set(currentProducts.map(p => p.name).filter(Boolean))];
    
    nameFilter.innerHTML = '<option value="">–í–µ—Å—å —Ç–æ–≤–∞—Ä</option>';
    uniqueNames.sort().forEach(name => {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        nameFilter.appendChild(option);
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—è–º, –µ—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    document.getElementById('nameFilterContainer').style.display = 
        uniqueNames.length > 0 ? 'flex' : 'none';
}

function displayProducts(productsArray) {
    const container = document.getElementById('productsContainer');
    container.innerHTML = '';
    
    // –°–Ω–∞—á–∞–ª–∞ —Ñ–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    let filteredProducts = currentFilter === 'all' 
        ? productsArray 
        : productsArray.filter(product => product.category === currentFilter);
    
    // –ó–∞—Ç–µ–º —Ñ–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ
    if (currentNameFilter) {
        filteredProducts = filteredProducts.filter(product => product.name === currentNameFilter);
    }
    
    if (filteredProducts.length === 0) {
        container.innerHTML = 
            '<div style="grid-column:1/-1;color:#aaa;padding:30px;font-size:0.95rem;text-align:center;">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</div>';
        return;
    }
    
    filteredProducts.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
    
    filteredProducts.forEach(product => {
        container.appendChild(createProductElement(product, product.id));
    });
    
    restoreModes();
}

function restoreModes() {
    if (deleteMode) {
        enableDeleteMode();
    } else if (editMode) {
        enableEditMode();
    }
}

function createProductElement(product, productId) {
    const div = document.createElement('div');
    div.className = 'product-item';
    div.dataset.id = productId;
    div.dataset.category = product.category || 'other';
    div.dataset.name = product.name || '';
    
    const quantity = product.quantity;
    let quantityText = '';
    let quantityClass = 'quantity-badge';
    let isAvailable = true;

    if (quantity === 'reserved') {
        quantityText = '–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ';
        quantityClass = 'quantity-badge reserved';
        isAvailable = false;
    } else if (quantity === 0 || quantity === '0') {
        quantityText = '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏';
        quantityClass = 'quantity-badge out-of-stock';
        isAvailable = false;
    } else {
        quantityText = `–û—Å—Ç–∞–ª–æ—Å—å: ${quantity} —à—Ç.`;
        isAvailable = true;
    }
    
    const category = product.category || 'other';
    
    const originalPrice = parseFloat(product.price || 0);
    let finalPrice = originalPrice;
    let discountText = '';
    
    // –°–∫–∏–¥–∫–∞ —Ç–æ–ª—å–∫–æ –≤ BYN
    if (product.discount && product.discount > 0) {
        finalPrice = originalPrice - product.discount;
        discountText = `-${product.discount.toFixed(2)} BYN`;
        finalPrice = Math.max(0, finalPrice);
    }
    
    const contentDiv = document.createElement('div');
    contentDiv.className = 'product-content';
    
    // –ù–∞–∑–≤–∞–Ω–∏–µ
    const nameDiv = document.createElement('div');
    nameDiv.className = 'product-name';
    nameDiv.textContent = product.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
    
    // –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
    const dividerDiv = document.createElement('div');
    dividerDiv.className = 'content-divider';
    
    // –í–∫—É—Å/–û–ø–∏—Å–∞–Ω–∏–µ
    const flavorDiv = document.createElement('div');
    flavorDiv.className = 'product-flavor';
    
    switch(category) {
        case 'pod':
            flavorDiv.textContent = product.flavor || '–ë—Ä–µ–Ω–¥ –Ω–µ —É–∫–∞–∑–∞–Ω';
            break;
        case 'other':
            flavorDiv.textContent = product.flavor || '–¢–∏–ø –Ω–µ —É–∫–∞–∑–∞–Ω';
            break;
        default:
            flavorDiv.textContent = product.flavor || '–í–∫—É—Å –Ω–µ —É–∫–∞–∑–∞–Ω';
    }
    
    // –ö—Ä–µ–ø–æ—Å—Ç—å (—Ç–æ–ª—å–∫–æ –¥–ª—è –∂–∏–¥–∫–æ—Å—Ç–µ–π –∏ —Å–Ω—é—Å–∞)
    if (product.strength && (category === 'liquid' || category === 'snus')) {
        const strengthDiv = document.createElement('div');
        strengthDiv.className = 'product-strength';
        strengthDiv.textContent = `–ö—Ä–µ–ø–æ—Å—Ç—å: ${product.strength}`;
        contentDiv.appendChild(strengthDiv);
    }
    
    // –¶–µ–Ω–∞
    const priceDiv = document.createElement('div');
    priceDiv.className = 'product-price';
    
    if (product.discount && product.discount > 0) {
        const discountContainer = document.createElement('div');
        discountContainer.className = 'discount-price';
        
        const originalPriceSpan = document.createElement('span');
        originalPriceSpan.className = 'original-price';
        originalPriceSpan.textContent = originalPrice.toFixed(2);
        
        const finalPriceSpan = document.createElement('span');
        finalPriceSpan.className = 'price-number';
        finalPriceSpan.textContent = finalPrice.toFixed(2);
        
        const discountBadge = document.createElement('span');
        discountBadge.className = 'discount-badge';
        discountBadge.textContent = discountText;
        
        discountContainer.appendChild(originalPriceSpan);
        discountContainer.appendChild(finalPriceSpan);
        discountContainer.appendChild(discountBadge);
        priceDiv.appendChild(discountContainer);
    } else {
        const priceSpan = document.createElement('span');
        priceSpan.className = 'price-number';
        priceSpan.textContent = originalPrice.toFixed(2);
        priceDiv.appendChild(priceSpan);
    }
    
    // –û—Å—Ç–∞—Ç–æ–∫
    const quantityDiv = document.createElement('div');
    quantityDiv.className = quantityClass;
    quantityDiv.textContent = quantityText;
    
    // –ö–Ω–æ–ø–∫–∞ –ø–æ–∫—É–ø–∫–∏
    const buyBtn = document.createElement('button');
    buyBtn.className = 'buy-btn';
    buyBtn.onclick = (e) => {
        e.stopPropagation();
        if (isAvailable) {
            showBuyModal(productId, category);
        } else {
            showNotification('‚ö†Ô∏è –¢–æ–≤–∞—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'warning');
        }
    };
    buyBtn.textContent = !isAvailable ? '–ù–ï–î–û–°–¢–£–ü–ù–û' : '–ö–£–ü–ò–¢–¨';
    if (!isAvailable) buyBtn.disabled = true;
    
    // –°–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    contentDiv.appendChild(nameDiv);
    contentDiv.appendChild(dividerDiv);
    contentDiv.appendChild(flavorDiv);
    contentDiv.appendChild(priceDiv);
    contentDiv.appendChild(quantityDiv);
    contentDiv.appendChild(buyBtn);
    
    // –°–±–æ—Ä–∫–∞ –≤—Å–µ–π –∫–∞—Ä—Ç–æ—á–∫–∏
    div.appendChild(contentDiv);
    
    return div;
}

// ====================== –§–ò–õ–¨–¢–†–ê–¶–ò–Ø ======================
function filterProducts(category) {
    currentFilter = category;
    currentNameFilter = '';
    
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    event.target.classList.add('active');
    
    document.getElementById('nameFilter').value = '';
    
    if (productsRef) {
        productsRef.once('value').then((snapshot) => {
            const products = snapshot.val();
            if (products) {
                const productsArray = Object.keys(products).map(productId => ({
                    id: productId,
                    ...products[productId]
                }));
                displayProducts(productsArray);
                updateNameFilter(productsArray);
            }
        });
    }
}

function filterByName() {
    const nameFilter = document.getElementById('nameFilter');
    currentNameFilter = nameFilter.value;
    
    if (productsRef) {
        productsRef.once('value').then((snapshot) => {
            const products = snapshot.val();
            if (products) {
                const productsArray = Object.keys(products).map(productId => ({
                    id: productId,
                    ...products[productId]
                }));
                displayProducts(productsArray);
            }
        });
    }
}

// ====================== –°–¢–ê–¢–ò–°–¢–ò–ö–ê ======================
async function showStatsModal() {
    document.getElementById('overlay').style.display = 'block';
    document.getElementById('statsModal').style.display = 'block';
    document.getElementById('adminPanel').style.display = 'none';
    
    await loadStats();
}

function closeStatsModal() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('statsModal').style.display = 'none';
}

async function loadStats() {
    try {
        const snapshot = await database.ref('products').once('value');
        const products = snapshot.val();
        
        const statsContent = document.getElementById('statsContent');
        
        if (!products) {
            statsContent.innerHTML = 
                '<div style="color:#aaa;padding:15px;text-align:center;font-size:0.9rem;">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</div>';
            return;
        }
        
        const productsArray = Object.values(products);
        const totalProducts = productsArray.length;
        
        // –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤
        const totalValue = productsArray.reduce((sum, p) => {
            const price = parseFloat(p.price) || 0;
            const quantity = p.quantity;
            if (quantity === 'reserved' || quantity === 0 || quantity === '0') return sum;
            const qty = parseInt(quantity) || 0;
            return sum + (price * qty);
        }, 0);
        
        // –¢–æ–≤–∞—Ä—ã –±–µ–∑ —Å–∫–∏–¥–∫–∏ –∏ —Å–æ —Å–∫–∏–¥–∫–æ–π
        const withoutDiscount = productsArray.filter(p => !p.discount || p.discount <= 0).length;
        const withDiscount = totalProducts - withoutDiscount;
        
        // –¢–æ–≤–∞—Ä—ã –≤ –Ω–∞–ª–∏—á–∏–∏, –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω—ã –∏ –Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏
        const inStock = productsArray.filter(p => {
            const quantity = p.quantity;
            return quantity !== 0 && quantity !== '0' && quantity !== 'reserved' && quantity !== undefined;
        }).length;

        const reserved = productsArray.filter(p => p.quantity === 'reserved').length;
        const outOfStock = totalProducts - inStock - reserved;
        
        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        const categories = {
            liquid: 0,
            pod: 0,
            snus: 0,
            other: 0
        };
        
        productsArray.forEach(product => {
            const cat = product.category || 'other';
            if (categories.hasOwnProperty(cat)) {
                categories[cat]++;
            }
        });
        
        // –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        statsContent.innerHTML = `
            <div style="
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
                text-align: center;
            ">
                <div style="padding: 8px;">
                    <div style="color: #d0c0ff; font-size: 0.8rem; margin-bottom: 4px;">–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤</div>
                    <div style="color: #9d4edd; font-weight: 700; font-size: 1.1rem;">${totalProducts}</div>
                </div>
                
                <div style="padding: 8px;">
                    <div style="color: #d0c0ff; font-size: 0.8rem; margin-bottom: 4px;">–í –Ω–∞–ª–∏—á–∏–∏</div>
                    <div style="color: #38ef7d; font-weight: 700; font-size: 1.1rem;">${inStock}</div>
                </div>
                
                <div style="padding: 8px;">
                    <div style="color: #d0c0ff; font-size: 0.8rem; margin-bottom: 4px;">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ</div>
                    <div style="color: #ffcc00; font-weight: 700; font-size: 1.1rem;">${reserved}</div>
                </div>
                
                <div style="padding: 8px;">
                    <div style="color: #d0c0ff; font-size: 0.8rem; margin-bottom: 4px;">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</div>
                    <div style="color: #ff4d4d; font-weight: 700; font-size: 1.1rem;">${outOfStock}</div>
                </div>
                
                <div style="padding: 8px;">
                    <div style="color: #d0c0ff; font-size: 0.8rem; margin-bottom: 4px;">–°–æ —Å–∫–∏–¥–∫–æ–π</div>
                    <div style="color: #ff4d8d; font-weight: 700; font-size: 1.1rem;">${withDiscount}</div>
                </div>
                
                <div style="padding: 8px;">
                    <div style="color: #d0c0ff; font-size: 0.8rem; margin-bottom: 4px;">–ë–µ–∑ —Å–∫–∏–¥–∫–∏</div>
                    <div style="color: #00b4db; font-weight: 700; font-size: 1.1rem;">${withoutDiscount}</div>
                </div>
                
                <div style="padding: 8px; grid-column: span 2;">
                    <div style="color: #d0c0ff; font-size: 0.8rem; margin-bottom: 4px;">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</div>
                    <div style="color: #ffcc00; font-weight: 700; font-size: 1rem;">${totalValue.toFixed(2)} BYN</div>
                </div>
            </div>
            
            <div style="margin-top: 15px; padding-top: 12px; border-top: 1px solid rgba(157,78,221,0.3);">
                <div style="color: #fff; font-weight: 600; margin-bottom: 8px; font-size: 0.85rem;">–ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:</div>
                <div style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 6px;
                    font-size: 0.8rem;
                ">
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #d0c0ff;">–ñ–∏–¥–∫–æ—Å—Ç–∏:</span>
                        <span style="color: #fff; font-weight: 600;">${categories.liquid}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #d0c0ff;">–ü–æ–¥-—Å–∏—Å—Ç–µ–º—ã:</span>
                        <span style="color: #fff; font-weight: 600;">${categories.pod}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #d0c0ff;">–°–Ω—é—Å:</span>
                        <span style="color: #fff; font-weight: 600;">${categories.snus}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #d0c0ff;">–†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏:</span>
                        <span style="color: #fff; font-weight: 600;">${categories.other}</span>
                    </div>
                </div>
            </div>
        `;
        
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:", error);
        document.getElementById('statsContent').innerHTML = 
            '<div style="text-align:center;padding:15px;color:#ff4d4d;font-size:0.9rem;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</div>';
    }
}

// ====================== –î–û–ë–ê–í–õ–ï–ù–ò–ï –¢–û–í–ê–†–ê ======================
async function addProduct() {
    if (isOperationInProgress) return;
    
    const submitBtn = document.querySelector('#addModal .confirm-modal-btn');
    const originalText = submitBtn.textContent;
    
    const name = document.getElementById('productName').value.trim();
    const flavor = document.getElementById('productFlavor').value.trim();
    const category = document.getElementById('productCategory').value;
    const strength = document.getElementById('productStrength').value.trim();
    const priceInput = document.getElementById('productPrice').value;
    const discountInput = document.getElementById('productDiscount').value;
    const quantity = document.getElementById('productQuantity').value;
    
    if (!name) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞', 'error');
        return;
    }
    
    if (!flavor) {
        const placeholder = document.getElementById('productFlavor').placeholder;
        showNotification(`–í–≤–µ–¥–∏—Ç–µ ${placeholder.toLowerCase()}`, 'error');
        return;
    }
    
    if (!category) {
        showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é', 'error');
        return;
    }
    
    if (!quantity) {
        showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–∞', 'error');
        return;
    }
    
    let price = parseFloat(priceInput);
    if (isNaN(price) || price < 0) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É', 'error');
        return;
    }
    
    if (price > 10000) {
        showNotification('–¶–µ–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 10 000 BYN', 'error');
        return;
    }
    
    let discount = parseFloat(discountInput) || 0;
    if (discount < 0) {
        showNotification('–°–∫–∏–¥–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π', 'error');
        return;
    }
    
    if (discount >= price) {
        showNotification('–°–∫–∏–¥–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–∞ —Ü–µ–Ω–µ', 'error');
        return;
    }
    
    isOperationInProgress = true;
    submitBtn.textContent = '–î–æ–±–∞–≤–ª—è–µ–º...';
    submitBtn.disabled = true;
    
    const newProduct = {
        name: name,
        flavor: flavor,
        category: category,
        price: price.toFixed(2),
        quantity: quantity,
        createdAt: Date.now()
    };
    
    if (strength && (category === 'liquid' || category === 'snus')) {
        newProduct.strength = strength;
    }
    
    if (discount > 0) {
        newProduct.discount = discount;
    }
    
    try {
        await database.ref('products').push(newProduct);
        closeAddModal();
        showNotification('‚úÖ –¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
        filterProducts(currentFilter);
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:", error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞', 'error');
    } finally {
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
        isOperationInProgress = false;
    }
}

function closeAddModal() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('addModal').style.display = 'none';
    
    ['productName', 'productFlavor', 'productStrength', 'productPrice', 'productDiscount'].forEach(id => {
        document.getElementById(id).value = '';
    });
    document.getElementById('productCategory').selectedIndex = 0;
    document.getElementById('productQuantity').selectedIndex = 0;
    document.getElementById('nameSelectContainer').style.display = 'none';
    document.getElementById('strengthContainer').style.display = 'block';
}

function showAddModal() {
    document.getElementById('overlay').style.display = 'block';
    document.getElementById('addModal').style.display = 'block';
    document.getElementById('adminPanel').style.display = 'none';
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
    document.getElementById('productCategory').selectedIndex = 0;
    document.getElementById('productName').value = '';
    document.getElementById('productFlavor').value = '';
    document.getElementById('productStrength').value = '';
    document.getElementById('productPrice').value = '';
    document.getElementById('productDiscount').value = '';
    document.getElementById('productQuantity').selectedIndex = 0;
    document.getElementById('nameSelectContainer').style.display = 'none';
    document.getElementById('strengthContainer').style.display = 'block';
}

// ====================== –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï ======================
function startEditMode() {
    editMode = true;
    deleteMode = false;
    document.getElementById('adminPanel').style.display = 'none';
    document.getElementById('exitEditBtn').style.display = 'block';
    document.getElementById('exitDeleteBtn').style.display = 'none';
    
    enableEditMode();
}

function enableEditMode() {
    document.querySelectorAll('.product-item').forEach(item => {
        item.classList.remove('delete-mode');
        item.classList.add('edit-mode');
        item.onclick = function(e) {
            if (isOperationInProgress) return;
            if (e.target.classList.contains('buy-btn') || e.target.closest('.buy-btn')) return;
            handleProductEdit(this);
        };
    });
}

function exitEditMode() {
    editMode = false;
    document.getElementById('exitEditBtn').style.display = 'none';
    
    document.querySelectorAll('.product-item').forEach(item => {
        item.classList.remove('edit-mode');
        item.onclick = null;
    });
}

async function handleProductEdit(product) {
    if (!editMode || isOperationInProgress) return;
    
    currentProductId = product.dataset.id;
    
    try {
        const snapshot = await database.ref('products/' + currentProductId).once('value');
        const productData = snapshot.val();
        
        if (!productData) return;
        
        document.getElementById('editProductName').value = productData.name || '';
        document.getElementById('editProductFlavor').value = productData.flavor || '';
        document.getElementById('editProductStrength').value = productData.strength || '';
        document.getElementById('editProductPrice').value = productData.price || '';
        document.getElementById('editProductDiscount').value = productData.discount || '';
        
        const categorySelect = document.getElementById('editProductCategory');
        categorySelect.value = productData.category || 'other';
        
        const quantitySelect = document.getElementById('editProductQuantity');
        quantitySelect.value = productData.quantity || '0';
        
        updateEditForm();
        
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('editModal').style.display = 'block';
        
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–∞:", error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–∞', 'error');
    }
}

async function saveProductEdit() {
    if (isOperationInProgress) return;
    
    const submitBtn = document.querySelector('#editModal .confirm-modal-btn');
    const originalText = submitBtn.textContent;
    
    const name = document.getElementById('editProductName').value.trim();
    const flavor = document.getElementById('editProductFlavor').value.trim();
    const category = document.getElementById('editProductCategory').value;
    const strength = document.getElementById('editProductStrength').value.trim();
    const priceInput = document.getElementById('editProductPrice').value;
    const discountInput = document.getElementById('editProductDiscount').value;
    const quantity = document.getElementById('editProductQuantity').value;
    
    if (!name) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞', 'error');
        return;
    }
    
    if (!flavor) {
        const placeholder = document.getElementById('editProductFlavor').placeholder;
        showNotification(`–í–≤–µ–¥–∏—Ç–µ ${placeholder.toLowerCase()}`, 'error');
        return;
    }
    
    if (!quantity) {
        showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–∞', 'error');
        return;
    }
    
    let price = parseFloat(priceInput);
    if (isNaN(price) || price < 0) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É', 'error');
        return;
    }
    
    if (price > 10000) {
        showNotification('–¶–µ–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 10 000 BYN', 'error');
        return;
    }
    
    let discount = parseFloat(discountInput) || 0;
    if (discount < 0) {
        showNotification('–°–∫–∏–¥–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π', 'error');
        return;
    }
    
    if (discount >= price) {
        showNotification('–°–∫–∏–¥–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–∞ —Ü–µ–Ω–µ', 'error');
        return;
    }
    
    isOperationInProgress = true;
    submitBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
    submitBtn.disabled = true;
    
    const updatedProduct = {
        name: name,
        flavor: flavor,
        category: category,
        price: price.toFixed(2),
        quantity: quantity,
        updatedAt: Date.now()
    };
    
    if (strength && (category === 'liquid' || category === 'snus')) {
        updatedProduct.strength = strength;
    } else {
        updatedProduct.strength = null;
    }
    
    if (discount > 0) {
        updatedProduct.discount = discount;
    } else {
        updatedProduct.discount = null;
    }
    
    try {
        await database.ref('products/' + currentProductId).update(updatedProduct);
        closeEditModal();
        showNotification('‚úÖ –¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!', 'success');
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:", error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞', 'error');
    } finally {
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
        isOperationInProgress = false;
    }
}

function closeEditModal() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('editModal').style.display = 'none';
    currentProductId = null;
}

// ====================== –ü–û–ö–£–ü–ö–ê ======================
async function showBuyModal(productId, category) {
    try {
        const snapshot = await database.ref('products/' + productId).once('value');
        const product = snapshot.val();
        
        if (!product || product.quantity === 0 || product.quantity === '0' || product.quantity === 'reserved') {
            showNotification('‚ö†Ô∏è –¢–æ–≤–∞—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'warning');
            return;
        }
        
        const categoryNames = {
            liquid: "–ñ–∏–¥–∫–æ—Å—Ç—å",
            pod: "–ü–æ–¥-—Å–∏—Å—Ç–µ–º–∞",
            snus: "–°–Ω—é—Å",
            other: "–†–∞—Å—Ö–æ–¥–Ω–∏–∫"
        };
        
        const categoryName = categoryNames[product.category] || '–î—Ä—É–≥–æ–µ';
        
        let finalPrice = parseFloat(product.price || 0);
        if (product.discount && product.discount > 0) {
            finalPrice = finalPrice - product.discount;
            finalPrice = Math.max(0, finalPrice);
        }
        
        orderText = `üì¶ –ó–∞–∫–∞–∑:\n\n` +
                   `–¢–æ–≤–∞—Ä: ${product.name}\n` +
                   `–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${categoryName}\n`;
        
        if (product.category === 'pod') {
            orderText += `–û–ø–∏—Å–∞–Ω–∏–µ: ${product.flavor}\n`;
        } else if (product.category === 'other') {
            orderText += `–¢–∏–ø: ${product.flavor}\n`;
        } else {
            orderText += `–í–∫—É—Å: ${product.flavor}\n`;
        }
        
        if (product.strength && (product.category === 'liquid' || product.category === 'snus')) {
            orderText += `–ö—Ä–µ–ø–æ—Å—Ç—å: ${product.strength}\n`;
        }
        
        if (product.discount && product.discount > 0) {
            orderText += `–¶–µ–Ω–∞: ${finalPrice.toFixed(2)} BYN (—Å–∫–∏–¥–∫–∞ ${product.discount} BYN)\n`;
        } else {
            orderText += `–¶–µ–Ω–∞: ${finalPrice.toFixed(2)} BYN\n`;
        }
        
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('buyModal').style.display = 'block';
        document.getElementById('orderText').textContent = orderText;
        
        const orderBlock = document.getElementById('orderTextBlock');
        orderBlock.onclick = function() {
            if (!navigator.clipboard) {
                const textArea = document.createElement('textarea');
                textArea.value = orderText;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showNotification('‚úÖ –¢–µ–∫—Å—Ç –∑–∞–∫–∞–∑–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!', 'success');
                } catch (err) {
                    showNotification('‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
                }
                document.body.removeChild(textArea);
                return;
            }
            
            navigator.clipboard.writeText(orderText).then(() => {
                this.style.background = 'linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(46, 125, 50, 0.2))';
                this.style.borderColor = '#4CAF50';
                this.querySelector('.order-text').style.color = '#9dff9d';
                
                setTimeout(() => {
                    this.style.background = '';
                    this.style.borderColor = '';
                    this.querySelector('.order-text').style.color = '';
                }, 1500);
                
                showNotification('‚úÖ –¢–µ–∫—Å—Ç –∑–∞–∫–∞–∑–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!', 'success');
            }).catch(err => {
                showNotification('‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
            });
        };
        
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞:", error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–∞', 'error');
    }
}

function closeBuyModal() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('buyModal').style.display = 'none';
}

// ====================== –£–î–ê–õ–ï–ù–ò–ï ======================
function startDeleteMode() {
    deleteMode = true;
    editMode = false;
    document.getElementById('adminPanel').style.display = 'none';
    document.getElementById('exitDeleteBtn').style.display = 'block';
    document.getElementById('exitEditBtn').style.display = 'none';
    
    enableDeleteMode();
}

function enableDeleteMode() {
    document.querySelectorAll('.product-item').forEach(item => {
        item.classList.remove('edit-mode');
        item.classList.add('delete-mode');
        item.onclick = function(e) {
            if (isOperationInProgress) return;
            if (e.target.classList.contains('buy-btn') || e.target.closest('.buy-btn')) return;
            handleProductDeletion(this);
        };
    });
}

function exitDeleteMode() {
    deleteMode = false;
    document.getElementById('exitDeleteBtn').style.display = 'none';
    
    document.querySelectorAll('.product-item').forEach(item => {
        item.classList.remove('delete-mode');
        item.onclick = null;
    });
}

async function handleProductDeletion(product) {
    if (!deleteMode || isOperationInProgress) return;
    
    productToDelete = product;
    currentProductId = product.dataset.id;
    
    const snapshot = await database.ref('products/' + currentProductId).once('value');
    const productData = snapshot.val();
    
    if (!productData) return;
    
    const name = productData.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
    const flavor = productData.flavor || '';
    
    document.getElementById('overlay').style.display = 'block';
    document.getElementById('deleteModal').style.display = 'block';
    document.getElementById('deleteProductInfo').innerHTML = 
        `–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?<br><br><strong style="color:#fff;">${name}</strong><br>${flavor}`;
}

function cancelDelete() {
    closeDeleteModal();
}

async function confirmDelete() {
    if (!currentProductId || isOperationInProgress) return;
    
    const submitBtn = document.querySelector('#deleteModal .confirm-modal-btn');
    const originalText = submitBtn.textContent;
    
    submitBtn.textContent = '–£–¥–∞–ª–µ–Ω–∏–µ...';
    submitBtn.disabled = true;
    isOperationInProgress = true;
    
    try {
        await database.ref('products/' + currentProductId).remove();
        
        closeDeleteModal();
        showNotification('‚úÖ –¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!', 'success');
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:", error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞', 'error');
    } finally {
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
        isOperationInProgress = false;
    }
}

function closeDeleteModal() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('deleteModal').style.display = 'none';
    productToDelete = null;
    currentProductId = null;
}

function closeAllModals() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('addModal').style.display = 'none';
    document.getElementById('editModal').style.display = 'none';
    document.getElementById('deleteModal').style.display = 'none';
    document.getElementById('buyModal').style.display = 'none';
    document.getElementById('loginForm').style.display = 'none';
    document.getElementById('statsModal').style.display = 'none';
    document.getElementById('adminPanel').style.display = 'none';
    productToDelete = null;
    currentProductId = null;
}

// ====================== –ó–ê–ì–†–£–ó–ö–ê ======================
window.addEventListener('DOMContentLoaded', function() {
    checkAuth();
    loadProducts();
    
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeAllModals();
        }
    });
    
    document.addEventListener('click', function(e) {
        const adminPanel = document.getElementById('adminPanel');
        const adminBtn = document.getElementById('adminBtn');
        
        if (adminPanel && adminPanel.style.display === 'block' && 
            !adminPanel.contains(e.target) && 
            !adminBtn.contains(e.target)) {
            adminPanel.style.display = 'none';
        }
    });
    
    document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
    });
});

window.addEventListener('beforeunload', () => {
    if (productsRef) {
        productsRef.off();
    }
});
</script>
</body>
</html>